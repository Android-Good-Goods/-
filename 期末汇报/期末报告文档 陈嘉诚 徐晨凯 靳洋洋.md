---
9title: 好物期末文档
author:
  - 陈嘉诚（1912190433）
  - 徐晨凯（1912190418）
  - 靳洋洋（1912190401）
description: |
  我们开发了一个基于安卓的二手商城，
  它前端采用安卓，后端采用Springboot/mybatis，
  实现了登录注册功能、购买功能、商品功能、个人信息功能、公益功能、收藏功能、消息列表功能、评论功能

---

# 一、项目介绍 [陈嘉诚、徐晨凯、靳洋洋]

## 背景

好物是一款主打闲置物品交易的的安卓软件应用。

生活中我们每个人都会有一些物品，因为时间、年龄、兴趣爱好、学习等各种原因产生很多闲置物品，为了帮助更多人处理自己的闲置物品，我们的应用给用户提供一个处理闲置物品的平台，用户在我们的应用里可以发布求购、发布公益活动、零元买、零元购、发现附近商品等功能。基于系统中的聊天功能，用户可以相约进行线下交易。相比市面上的软件，其体积更加轻便，使用更加简单，没有了广告植入也使得页面更加简洁。

随着生活品质的提升，人们拥有的物品种类及数量越来越多，闲置物品管理问题也愈渐成为人们日常生活的普遍痛点。闲置物品对自己来说没有用，丢了又觉得可惜。据统计，大学的师生有79.8%的人都有自己的闲置物品，其中40%的人会将自己的物品闲置，有15%的人会选择把闲置物品捐赠给他人，有31%的人希望通过跳蚤市场出售自己的闲置物品，还有14%的人不知道怎么处理自己的闲置物品。然而，并不是所有学校都有跳瘙市场，对于很多高校学生来说，始终缺乏一个交易的平台，我们这个软件就能帮助用户们方便的处理闲置物品。

## 项目需求分析

### 用户需求分析

1.要求APP具备交易二手商品的功能。

2.APP操作要求尽可能简便灵活。

3.APP具备买卖之后的协商沟通的功能。

4.APP尽量保护用户的个人隐私安全。

### 用户定位

1.想要购买二手商品或者“淘”一个二手宝贝的人。

2.想要处理掉（卖掉或者公益捐赠）二手闲置物品的人。

3.对公益事业不反感，能够多做一些公益活动的人。

4.尽可能将人群定位在大学生范围。

### 需求分析

| **序号** | **使用场景**                                   | **问题需求**                 | **对应功能**           |
| -------- | ---------------------------------------------- | ---------------------------- | ---------------------- |
| **1**    | 有一些物品长期未用，能针对使用情况做出规划     | 汇总物品使用情况挂到网上专卖 | 市场，发布商品         |
| **2**    | 有一些物品长期为用，但是不适合转卖的物品。     | 不合身的衣服和鞋子           | 可以零元卖，或者做公益 |
| **3**    | 想购买别人的闲置，不通过中间平台就能与卖家沟通 | 能低价购买他人所有、自己所需 | 搜索、求购、消息       |

### 功能分析

功能层面思维导图：

<img src="G:\大三课程\移动互联开发实战\好物\design\好物.png" alt="好物" style="zoom:67%;" />

## 计划和分工

•陈嘉诚：API的主要设计，后端部分主要设计开发，数据库设计开发，原型和系统构架主要设计。

•徐晨凯：前端的主要设计开发，后端用户部分实现（环信匹配前端），测试主要负责人，参与原型和系统构架设计。

•靳洋洋：前端工作辅助实现，API设计，系统部署，参与原型和系统构架设计。

# 二、界面原型设计 [陈嘉诚、徐晨凯、靳洋洋]

## 登录模块

跳转逻辑图：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609172955488.png" alt="image-20220609172955488" style="zoom:67%;" />

用户点击APP后会自动进入登录加载界面（图标界面），之后会记入登录界面。此处出现选择项，已经注册过的可以再输入账号密码验证码后登录进入主页面，未完成注册的需要点击“我要注册”进入注册界面填入相关信息完成注册后返回登录界面，重复登录步骤再进入主界面。

设计思路：加载界面纯粹是为了让APP看起来更具有一定的真实性（模拟加载广告），登录注册功能一般来说都是没一个APP必备的功能，增加了验证码是为了提高用户信息的安全性。

实现的难度一般，主要是后端逻辑方面要弄清楚就可以。

界面设计图：

加载界面

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609191154865.png" alt="image-20220609191154865" style="zoom:67%;" />

登录界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609191228251.png" alt="image-20220609191228251" style="zoom:67%;" />

注册界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609191255776.png" alt="image-20220609191255776" style="zoom:67%;" />

主界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609194343219.png" alt="image-20220609194343219" style="zoom: 80%;" />

底部导航栏：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609204345714.png" alt="image-20220609204345714" style="zoom:67%;" />



## 个人模块

功能路径图（点击进入下一层）：此图逻辑上符合跳转关系。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609174219609.png" alt="image-20220609174219609" style="zoom: 50%;" />

个人中心的界面设计参考的是一般的电商平台的基本设计，包含的功能项相对来说比较固定，界面设计比较传统，稍有不同的是在会在该界面中展示出“账户余额”和“个人信誉”，区别于其他电商平台的是我们的项目中增添了公益的功能。

实现难度不大，但是代码量比较大。

个人界面（主）：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609191917715.png" alt="image-20220609191917715" style="zoom: 80%;" />

个人资料界面： 
<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609191541306.png" alt="image-20220609191541306" style="zoom: 67%;" />    

修改界面（包括昵称、性别、学校、联系方式（此处以昵称为例，别的都是一样的））

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609192332435.png" alt="image-20220609192332435" style="zoom:67%;" />

“我买到的”界面+“我卖出的”界面：采用列表的形式

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609192549953.png" alt="image-20220609192549953" style="zoom:50%;" /><img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609192605212.png" alt="image-20220609192605212" style="zoom:50%;" />

“我发布的”界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609192650443.png" alt="image-20220609192650443" style="zoom:67%;" />

“我的免费送”界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609192747952.png" alt="image-20220609192747952" style="zoom: 67%;" />

“我的收藏”界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609204820082.png" alt="image-20220609204820082" style="zoom:67%;" />



“我的公益”界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609204716175.png" alt="image-20220609204716175" style="zoom:67%;" />



设置界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609192917201.png" alt="image-20220609192917201" style="zoom:67%;" />

修改密码界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609193101190.png" alt="image-20220609193101190" style="zoom:67%;" />

## 商品模块

逻辑跳转图：

![image-20220609194228513](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609194228513.png)

设计说明：通过登录后进入了主页，此时是可以看到一些商品分类和个别推荐购买的商品的图片，点击图片是可以进入商品的具体详情界面的。也可以通过在顶部的搜索栏完成关键字搜索找到相关商品。同时，也可以通过点击中间的商品分类进入先关商品烈表，没有目标分类就点击“更多”进入分类大表寻找。进入指定的商品分类列表后会看到先关商品，点击商品图标即可进入商品详情界面。

用户可以在商品详情界面点击左上方的“**☆**”完成对商品的收藏，收藏的商品可以在个人中心的“我的收藏”中查看。

此外，商品详情界面是可以进行评论功能的，用户可以在商品详情界面的底部发布评论。

此部分实现难度还是比较小的。

商品分类界面：
![<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609194841737.png" alt="image-20220609194841737" style="zoom:67%;" />]

商品烈表界面：采用列表的形式

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609194809977.png" alt="image-20220609194809977" style="zoom:67%;" />

商品详情界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609195108573.png" alt="image-20220609195108573" style="zoom:67%;" />

评论界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609211355643.png" alt="image-20220609211355643" style="zoom:67%;" />

## 购买模块

购买逻辑图：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609195921956.png" alt="image-20220609195921956" style="zoom:67%;" />

功能说明：购买模块按照功能实际上可也拆封成购买功能和订单功能，购买功能在实现的时候会生成订单。

设计说明：我们在设计时模仿了淘宝的购买逻辑，联系卖家可以在购买前先有对商品找卖家进行了解后再购买。卖家在购买后会生成订单，订单可以在个人中心内进行查看，订单可以取消（符合退货逻辑）。用户在个人中心内确认订单后，完整的购买逻辑才算是完成，此时订单状态也会从“发货中”变成“已完成”。

此部分逻辑实现难度比较大，运算步骤比较多，跳转也比较多。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609201046733.png" alt="image-20220609201046733" style="zoom:67%;" />

## 发布模块

跳转逻辑图：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609202101576.png" alt="image-20220609202101576" style="zoom:80%;" />

设计说明：我们在设计发布模块时选择按照发布的类型的不同将需要发布的情况分为五类，其中发布拍卖属于计划的一部分（模仿阿里拍卖）但是本次开发未去实现，属于项目后期扩展。

发布界面下可以进入各发布分支，我们在设计分支界面时设置了比较多的需要填入的信息数据，这些数据信息在商品发布之后会出现在商品详情界面，方便于买家了解商品的详情。

发布模块发布的一切类型的数据信息都可以在个人界面的“我的发布”中查看。

实现难度来说不是很大，但是由于分类比较多，数据处理也比较多，代码量会比较大。



发布闲置界面（可视为发布商品）：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609203057564.png" alt="image-20220609203057564" style="zoom:67%;" />

发布求购界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609203215137.png" alt="image-20220609203215137" style="zoom:67%;" />

发布公益界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609203320458.png" alt="image-20220609203320458" style="zoom:67%;" />

## 公益模块

逻辑跳转图：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609205546523.png" alt="image-20220609205546523" style="zoom: 80%;" />



设计说明：公益模块的设计比较类似与商品设计，按照“主界面”->"列表"->"详情界面"的进入搜索逻辑，以“参加公益”->“退出”/“公益结束”的实践逻辑来实行，可以从“个人中心”中对“公益活动”进行信息获取了解情况或退出公益。

此部分的难度不是很大，参考“商品模块”，性质比较相似，由于信息数据比较多，代码量会比较多。



公益界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609204103180.png" alt="image-20220609204103180" style="zoom:67%;" />

公益列表：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609205020265.png" alt="image-20220609205020265" style="zoom:67%;" />

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609205043670.png" alt="image-20220609205043670" style="zoom:67%;" />

公益详情界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609203954926.png" alt="image-20220609203954926" style="zoom:67%;" />

## 消息模块

功能展示图：

![image-20220609212116781](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609212116781.png)



设计说明：消息模块的主要功能在于用户买卖商品进行交易后，系统会默认的反馈信息提示用户相关操作完成，一般会提示“你的商品XXXXXXXX”。

还可以进行卖家和买家间通过“联系卖家”进行交流。

此部分难度一般，主要难度在于消息的存储。

消息界面：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609211639655.png" alt="image-20220609211639655" style="zoom: 80%;" />

系统消息界面：
<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609211201111.png" alt="image-20220609211201111" style="zoom:67%;" />





# 三、系统架构设计 [陈嘉诚、徐晨凯、靳洋洋]

## Android端设计

Android构架按照MVC模式开发，分为了Model层、View层和Controller层。Model层是View层和Controller层的中间层，主要负责处理全局数据，保证全局数据的一致；View层是控制应用视图显示的一层，主要作用是显示应用数据；Controller层是MVC架构中最重要的一层，实现了客户端底层的逻辑处理，使得客户端能够平稳运行。

从功能的角度，android端可以被视为完成了4种核心功能，包括用户管理功能（登录注册、个人管理）、发布浏览功能、购买交易订单功能、其他辅助功能。

用户管理功能需要实现登录注册的逻辑跳转，与后端连接后需要对账号密码进行验证管理，以此来确定账号可以正确地登录。

发布浏览功能需要实现实现发布功能，需要实现各页面之间的切换和目录切换的浏览功能，也需要实现对商品、公益两部分模块内置参数的数据传输。

购买交易订单功能需要完成从购买跳转到交易订单的实现功能，并且需要完成对应的逻辑切换。

其他辅助功能实现一些配合核心功能实现的基础功能。

Android端结构目录：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609225412326.png" alt="image-20220609225412326" style="zoom: 67%;" />







## 服务端设计

服务端在开发是在Intellil IDEA 中开发的，用的是Springboot（Maven）框架搭配MyBatis对数据进行处理，插件上使用了Lombok简化代码结构，使用了驼峰映射的技术，最终通过Tomcat Apache服务器来实现数据的传输处理。

后端功能大致分为订单功能、商品功能、消息功能、发布功能、评论功能、购买功能、公益功能、用户功能、收藏功能。

订单功能主要实现的是用户在购买商品后产生订单处理其数据的功能。

商品功能主要实现的商品的发布、删除时的数据处理（增删减查）。

发布功能需要实现关于商品、公益从用户类传递到对应类中数据传输的过程。

评论功能实现的是用户在商品界面输出相关数据并储存数据的功能。

购买功能需要实现用户对于商品转换到订单逻辑到最终输出逻辑的转换。

公益功能主要实现的是对公益类的管理操作（增删检查）。

用户功能需要实现登录注册逻辑及其验证，也需要实现对用户本身数据的储存、调用、输出。

收藏功能则需要完成用户类对商品类的保存输出工作。

后端结构目录：

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609230638004.png" alt="image-20220609230638004" style="zoom:67%;" />

## 数据库设计

数据库设计参照了比较传统的设计和开发，生成的表可以符合前后端对数据的需求，没有使用什么特别的开发技术，采用的是一般的建表技术。

数据库的表名比较贴近与后端的功能设计名称，这样做的好处是看起来比较符合后端的逻辑实现。

开发设备选取了Navicat，数据库选择上使用了MySQL。

数据库表结构：

![image-20220609232705941](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609232705941.png)

## API设计

API的设计是前后端数据测试的基础，从设计的角度参照的角度是Android端的界面。

API根据具体的界面中所具备的功能设置相对应的接口，便于对数据传输进行测试操作。

API结构：

![image-20220610010554684](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610010554684.png)

# 四、API设计 [陈嘉诚、靳洋洋]

## 模块介绍

根据功能进行的分组模块设计，设计了登录，商品、个人、购买、发布、聊天和公益模块的各个接口。

#### 登录模块

用户首次使用客户端时必须进行注册账号再登录才可进入客户端，只有先进行注册才能登录。用户注册时，可以自行填写账号，作为此后登录APP的账号。填写完账号密码昵称等用户基本数据，点击“我要注册”，客户端会生成json数据.

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609210712950.png" alt="image-20220609210712950" style="zoom:80%;" />

#### **商品模块**

对于商品模块，我们主要分为了商品列表和商品细节。我们基于商品的的各种属性来定义我们商品类表中的各个参数名，根据商品的属性对各个参数名的类型划分为integer，string，bool等。

商品列表，含有商品的全部信息，但是一般只展示图片和一些基础信息。

商品细节，我们设置商品细节是为了提供更好的用户体验，让用户再点击商品之后，不仅可以看到商品的各种信息，还能看到个体卖家的一些基础信息，这样可以帮助用户在购物的时候提供卖家的信息，使购物更加的透明。

评论区：我们还对商品进行了评论功能，可以在线和老板讨价还价，或者和其他有共同购买意愿的人进行交流，

收藏：用户可以收藏想买的商品，收藏之后可以方便查看。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609210733365.png" alt="image-20220609210733365" style="zoom:80%;" />

#### **个人模块**

个人中心是软件所有功能点的的集合入口，流量仅次于首页。用户使用软件功能时，除其他亮点功能外，个人中心的修改编辑个人信息，查看线上行为信息，设置app通用功能，掌握线上活动，商城订单，联系平台方等等都需要通过个人中心进行。

我的页面：可以用来显示个人的基本信息，购买，发布等都需要在个人页面查看。

对于一款电商软件来说，收货地址也很重要，所以需要的专门的管理各个收货地址。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609210829645.png" alt="image-20220609210829645" style="zoom:80%;" /><img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609210836476.png" alt="image-20220609210836476" style="zoom:80%;" />

个人页面：也可以用来修改个人的基本信息，包括头像，昵称联系方式等，需要接口连接。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609210856793.png" alt="image-20220609210856793" style="zoom:80%;" />

收藏功能因为添加了商品的收藏功能，所以我们需要在个人页面能够有一个可以产看收藏页面的通道，在个人页面中实现收藏页面的查看删除功能，方便界面的整体美观、优化、简化，而且基本上所有的应用软件收藏功能都在个人页面，所以这也比较符合用户的使用习惯。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609210909736.png" alt="image-20220609210909736" style="zoom:80%;" />

最后就是商品的订单信息，用来查看购买的商品和发布的商品。购买模块中是上传列表，在这里直接get查看。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609210919917.png" alt="image-20220609210919917" style="zoom:80%;" />

#### 购买模块

购买商品是电商最重要的功能，在接口设计中，我们只要考虑用户购买商品之后，商品的购买属性从可买到不可买，然后生成订单信息发给用户。

订单信息包含买卖双方的进本信息，商品的基本信息和交易时间，订单只具有查看和删除功能，不考虑更改功能。对于用户自己卖出的商品，仍然可以生成新的订单。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609210931933.png" alt="image-20220609210931933" style="zoom:80%;" />

#### 发布模块

用户可以再发布功能模块发布自己想卖的商品到商城里，实现二手交易的功能。

发布商品可以选择发布商品的位置信息，这样对于一些不方便邮寄的物品，相当于增加了交易流通的渠道，用户甚至可以再简单交流之后，进行线下交流。当然这个功能主要是为了公益活动考虑，如果有用户距离这个公益地点近，用户就可以根据实际情况来决定是否参加公益，就近实现公益活动。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609211009520.png" alt="image-20220609211009520" style="zoom:80%;" />

#### 消息模块

只要求实现买家和卖家的简单沟通功能，需要调用接口的get和post功能，

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609211024716.png" alt="image-20220609211024716" style="zoom:80%;" />

#### 公益模块

作为新时代的大学生，我们都应该为社会贡献自己的一份力量，所以我们设计了工艺模块，工艺模块发布一些工艺内容，可以是筹集捐款、捐物买也可以是志愿活动。公益活动有各种状态，随着公益活动的进行会不断的改变状态，在工艺结束前都可以加入工艺。

工艺列表用来展示用户参加过的公益，可以增加用户的成就感和荣誉感，弘扬正能量。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220609211036466.png" alt="image-20220609211036466" style="zoom:80%;" />

 

并通过 APIfox 介绍 API 的设计理念：我们对接口的设计理念是追求一直和简单，我们的设计理念来自于我们的数据库设计，我们对接口的命名方式采用了和数据库一样的命名方式，这样更方便我们的日常工作的进行。首先是对于用户模块，我们使用User的大写首字母加上属性的英文名称组合的方式进行命名，如Upwd是指用户的密码，Usex就是指用户的性别。对于奇、其他的功能模块也是采取的同样的命名方式，如商品一般采用Good的首字母作为前缀。这样的设计方式便于理解和使用。

接口的基本逻辑：查询接口get  新增接口post  修改接口put  删除接口delete

## API用例详解说明

### 好物1.0

> v1.0.0

### 主界面

##### HEAD 主界面

HEAD /main

> 返回示例

> 成功

```json
{
  "data": "false"
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型   | 必选 | 约束 | 说明 |
| ------ | ------ | ---- | ---- | ---- |
| » data | string | true | none | none |

### 登录/登录加载界面

#### LINK 登录加载

LINK /welcome

> 返回示例

> 成功

```json
{
  "data": "false"
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型   | 必选 | 约束 | 说明 |
| ------ | ------ | ---- | ---- | ---- |
| » data | string | true | none | none |

#### 登录/登录界面

##### GET 登录

GET /User/login

##### 请求参数

| 名称     | 位置  | 类型   | 必选 | 说明 |
| -------- | ----- | ------ | ---- | ---- |
| Uaccount | query | string | 否   | 账号 |
| Upwd     | query | string | 否   | 密码 |

> 返回示例

> 成功

```json
{
  "Uaccount": "630000200501263954",
  "Upwd": "cWP1dYc"
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称       | 类型   | 必选 | 约束 | 说明 |
| ---------- | ------ | ---- | ---- | ---- |
| » Uaccount | string | true | none | none |
| » Upwd     | string | true | none | none |

##### POST 注册

POST /User/signup

##### 请求参数

| 名称        | 位置  | 类型   | 必选 | 说明                         |
| ----------- | ----- | ------ | ---- | ---------------------------- |
| Uaccount    | query | string | 否   | 用户ID，主键                 |
| Upwd        | query | string | 否   | 只能包含数字和字母           |
| Uid         | query | string | 否   | 环信id                       |
| Unickname   | query | string | 否   | none                         |
| Uphoto      | query | string | 否   | 头像存储路径                 |
| Usex        | query | string | 否   | 1男2女                       |
| Ubalance    | query | string | 否   | 账户余额	保留小数点后两位 |
| Uaddress    | query | string | 否   | 地址                         |
| Uschool     | query | string | 否   | 学校                         |
| Ureputation | query | string | 否   | 信誉值                       |
| Utel        | query | string | 否   | 电话                         |

> 返回示例

> 成功

```json
{
  "Uaccout": "710000198706145812",
  "Upwd": "D&%ww",
  "Uid": "Y67p&u",
  "Unickname": "小明",
  "Uphote": "http://dummyimage.com/720x300",
  "Usex": 8310573980326868,
  "Ubalance": -8189015074820492,
  "Uaddress": "上海 上海市 长宁区",
  "Uschool": "浙江工商大学",
  "Ureputation": "86",
  "Utel": "18637877681"
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称          | 类型    | 必选 | 约束 | 说明 |
| ------------- | ------- | ---- | ---- | ---- |
| » Uaccout     | string  | true | none | none |
| » Upwd        | string  | true | none | none |
| » Uid         | string  | true | none | none |
| » Unickname   | string  | true | none | none |
| » Uphote      | string  | true | none | none |
| » Usex        | integer | true | none | none |
| » Ubalance    | number  | true | none | none |
| » Uaddress    | string  | true | none | none |
| » Uschool     | string  | true | none | none |
| » Ureputation | string  | true | none | none |
| » Utel        | string  | true | none | none |

#### 商品界面/商品分类界面

##### OPTIONS 商品列表

OPTIONS /Goods/index

> 返回示例

> 成功

```json
{
  "data": "false"
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型   | 必选 | 约束 | 说明 |
| ------ | ------ | ---- | ---- | ---- |
| » data | string | true | none | none |

#### 商品界面/商品列表

##### PUT 商品列表

PUT /Goods/Goodsdetail

##### 请求参数

| 名称        | 位置  | 类型   | 必选 | 说明                                                         |
| ----------- | ----- | ------ | ---- | ------------------------------------------------------------ |
| Uid         | query | string | 否   | 用户ID                                                       |
| Uaccount    | query | string | 否   | 账号                                                         |
| Unickname   | query | string | 否   | 昵称                                                         |
| Ureputation | query | string | 否   | 信誉值                                                       |
| Utel        | query | string | 否   | none                                                         |
| Gid         | query | string | 否   | 商品ID                                                       |
| Gname       | query | string | 否   | 商品名                                                       |
| Ghownew     | query | string | 否   | 新旧程度                                                     |
| Gprice      | query | string | 否   | 商品价格                                                     |
| Ggetway     | query | string | 否   | 交易方式，邮寄或自提                                         |
| Goprice     | query | string | 否   | 商品原价                                                     |
| Gdetail     | query | string | 否   | 商品描述                                                     |
| Gaddress    | query | string | 否   | 发货地址                                                     |
| Gscannum    | query | string | 否   | 浏览人数                                                     |
| Gtype       | query | string | 否   | 商品类型                                                     |
| Gstate      | query | string | 否   | 商品状态，1表示在售，2表示在交易中，3表示交易成功,4表示交易失败，5表示已删除 |
| Gimage      | query | string | 否   | 商品图片存储路径                                             |

> 返回示例

> 成功

```json
{
  "Uid": 44000020031028110,
  "Uaccount": "810000199801012813",
  "Unickname": "(ekZ2",
  "Ureputation": "98",
  "Utel": "19884455218",
  "Gid": 120000200706089650,
  "Gname": "苹果",
  "Ghownew": "4760754109108269",
  "Gprice": 3.2,
  "Ggetway": "邮寄",
  "Goprice": 5,
  "Gdetail": "好还不贵。",
  "Gaddress": "湖南省 株洲市 芦淞区",
  "Gscannum": 8446114175372600,
  "Gtpye": "水果",
  "Gstate": 1,
  "Gimage": "http://dummyimage.com/720x300"
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称          | 类型    | 必选 | 约束 | 说明 |
| ------------- | ------- | ---- | ---- | ---- |
| » Uid         | integer | true | none | none |
| » Uaccount    | string  | true | none | none |
| » Unickname   | string  | true | none | none |
| » Ureputation | string  | true | none | none |
| » Utel        | string  | true | none | none |
| » Gid         | integer | true | none | none |
| » Gname       | string  | true | none | none |
| » Ghownew     | string  | true | none | none |
| » Gprice      | number  | true | none | none |
| » Ggetway     | string  | true | none | none |
| » Goprice     | number  | true | none | none |
| » Gdetail     | string  | true | none | none |
| » Gaddress    | string  | true | none | none |
| » Gscannum    | integer | true | none | none |
| » Gtpye       | string  | true | none | none |
| » Gstate      | integer | true | none | none |
| » Gimage      | string  | true | none | none |

#### 商品界面/商品细节

##### POST 商品设置

POST /Goods/setgoods

##### 请求参数

| 名称     | 位置  | 类型   | 必选 | 说明                                                         |
| -------- | ----- | ------ | ---- | ------------------------------------------------------------ |
| Gname    | query | string | 否   | 商品名称                                                     |
| Gprice   | query | string | 否   | 商品价格                                                     |
| Goprice  | query | string | 否   | 商品原价格                                                   |
| Gtype    | query | string | 否   | 商品类型                                                     |
| Ghownew  | query | string | 否   | 新旧程度                                                     |
| Ggetway  | query | string | 否   | 交易方式，邮寄或自提                                         |
| Gdetail  | query | string | 否   | 商品描述                                                     |
| Gimage   | query | string | 否   | 商品图片存储路径                                             |
| Gstate   | query | string | 否   | 商品状态，1表示在售，2表示在交易中，3表示交易成功,4表示交易失败，5表示已删除 |
| Gscannum | query | string | 否   | 浏览人数                                                     |
| Gaddress | query | string | 否   | 发货地址                                                     |

> 返回示例

> 成功

```json
{
  "Gname": "栗子",
  "Gprice": 30,
  "Goprice": 40,
  "Gtype": "情",
  "Ghownew": 81.2,
  "Ggetway": "自取",
  "Gdetail": "始会属开转化个无军以与越联华整面。",
  "Gimage": "http://dummyimage.com/336x280",
  "Gaddress": "青海省 海南藏族自治州 兴海县",
  "Gstate": 3,
  "Gscannum": 617
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称       | 类型    | 必选 | 约束 | 说明 |
| ---------- | ------- | ---- | ---- | ---- |
| » Gname    | string  | true | none | none |
| » Gprice   | number  | true | none | none |
| » Goprice  | number  | true | none | none |
| » Gtype    | string  | true | none | none |
| » Ghownew  | number  | true | none | none |
| » Ggetway  | string  | true | none | none |
| » Gdetail  | string  | true | none | none |
| » Gimage   | string  | true | none | none |
| » Gaddress | string  | true | none | none |
| » Gstate   | integer | true | none | none |
| » Gscannum | integer | true | none | none |

#### PUT 评论收藏

PUT /collect/getcollect

##### 请求参数

| 名称     | 位置  | 类型   | 必选 | 说明         |
| -------- | ----- | ------ | ---- | ------------ |
| Conid    | query | string | 否   | 主键，评论id |
| Uaccount | query | string | 否   | none         |
| Gid      | query | string | 否   | none         |
| Uid      | query | string | 否   | none         |

> 返回示例

> 成功

```json
{
  "Conid": "640000199708203146"
}
```

```json
{
  "Conid": "450000200001312867",
  "Uaccount": "610000197003205833",
  "Gid": 610000199910158300,
  "Uid": 120000202105195700
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称       | 类型    | 必选 | 约束 | 说明 |
| ---------- | ------- | ---- | ---- | ---- |
| » Conid    | string  | true | none | none |
| » Uaccount | string  | true | none | none |
| » Gid      | integer | true | none | none |
| » Uid      | integer | true | none | none |

#### PUT 评论区

PUT /buycoments/conments

##### 请求参数

| 名称       | 位置  | 类型   | 必选 | 说明           |
| ---------- | ----- | ------ | ---- | -------------- |
| Uphote     | query | string | 否   | 头像存储路径   |
| Uid        | query | string | 否   | 用户id	主键 |
| Uaccount   | query | string | 否   | 账号           |
| Unickname  | query | string | 否   | 昵称           |
| Concontent | query | string | 否   | 评论内容       |
| Contime    | query | string | 否   | 评论时间       |
| Conid      | query | string | 否   | 评论id，主键   |

> 返回示例

> 成功

```json
{
  "Uphote": "http://dummyimage.com/250x250",
  "Uid": 500000199403227840,
  "Uaccount": "500000201908204345",
  "Unickname": "lTci6M",
  "Concontent": "群装放好油世领除声么设便己面结历被。",
  "Contime": "2018-10-27 AM 09:25:10",
  "Conid": "410000197808213331"
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称         | 类型    | 必选 | 约束 | 说明 |
| ------------ | ------- | ---- | ---- | ---- |
| » Uphote     | string  | true | none | none |
| » Uid        | integer | true | none | none |
| » Uaccount   | string  | true | none | none |
| » Unickname  | string  | true | none | none |
| » Concontent | string  | true | none | none |
| » Contime    | string  | true | none | none |
| » Conid      | string  | true | none | none |

#### GET 加载项获取权限信息

GET /Goods/goods

##### 请求参数

| 名称        | 位置  | 类型   | 必选 | 说明         |
| ----------- | ----- | ------ | ---- | ------------ |
| Uphoto      | query | string | 否   | 头像存储路径 |
| Unickname   | query | string | 否   | 昵称         |
| Ureputation | query | string | 否   | 信誉值       |

> 返回示例

> 成功

```json
{
  "Uphote": "http://dummyimage.com/728x90",
  "Unickname": "mwXz",
  "Ureputation": 70
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称          | 类型    | 必选 | 约束 | 说明 |
| ------------- | ------- | ---- | ---- | ---- |
| » Uphote      | string  | true | none | none |
| » Unickname   | string  | true | none | none |
| » Ureputation | integer | true | none | none |

### 购买界面/购买细节

#### GET 求购商品

GET /buy/buydetail

##### 请求参数

| 名称     | 位置  | 类型   | 必选 | 说明                                  |
| -------- | ----- | ------ | ---- | ------------------------------------- |
| Bname    | query | string | 否   | 求购id	主键                        |
| Bsprice  | query | string | 否   | 最低价	保留小数点后两位            |
| Bbprice  | query | string | 否   | 最高价	保留小数点后两位            |
| Btype    | query | string | 否   | 求购类型                              |
| Bhownew  | query | string | 否   | 新旧程度                              |
| Bgetway  | query | string | 否   | 交易方式                              |
| Bdetail  | query | string | 否   | 求购介绍                              |
| Bimage   | query | string | 否   | 求购图片                              |
| Baddress | query | string | 否   | 发布地址                              |
| Bscannum | query | string | 否   | 浏览人数                              |
| Bstate   | query | string | 否   | 求购状态，1求购状态，2求购到，3已删除 |

> 返回示例

> 成功

```json
{
  "Bname": "2^U",
  "Bsprice": 58,
  "Bbprice": 60,
  "Btype": "玩具",
  "Bhownew": "82.26",
  "Bgetway": "自取",
  "Bdetail": "且与争必些些示感化细红出省九几之除。",
  "Bimage": "http://dummyimage.com/728x90",
  "Baddress": "福建省 福州市 马尾区",
  "Bscannum": 651,
  "Bstate": "1"
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称       | 类型    | 必选 | 约束 | 说明 |
| ---------- | ------- | ---- | ---- | ---- |
| » Bname    | string  | true | none | none |
| » Bsprice  | number  | true | none | none |
| » Bbprice  | number  | true | none | none |
| » Btype    | string  | true | none | none |
| » Bhownew  | string  | true | none | none |
| » Bgetway  | string  | true | none | none |
| » Bdetail  | string  | true | none | none |
| » Bimage   | string  | true | none | none |
| » Baddress | string  | true | none | none |
| » Bscannum | integer | true | none | none |
| » Bstate   | string  | true | none | none |

#### PUT 购买表

PUT /buy/buydetail

##### 请求参数

| 名称 | 位置  | 类型   | 必选 | 说明           |
| ---- | ----- | ------ | ---- | -------------- |
| Bid  | query | string | 否   | 求购id	主键 |

> 返回示例

> 成功

```json
{
  "Bid": 620000197405286700
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称  | 类型    | 必选 | 约束 | 说明 |
| ----- | ------- | ---- | ---- | ---- |
| » Bid | integer | true | none | none |

### 购买界面/订单界面

#### PUT 上传订单

PUT /buy/account

##### 请求参数

| 名称  | 位置  | 类型   | 必选 | 说明                         |
| ----- | ----- | ------ | ---- | ---------------------------- |
| Aid   | query | string | 否   | 订单id	主键               |
| Gid   | query | string | 否   | 商品id	外键               |
| Gname | query | string | 否   | 商品名称                     |
| Uid   | query | string | 否   | 买家id	外键               |
| Abill | query | string | 否   | 订单金额	保留小数点后两位 |
| Atime | query | string | 否   | 交易时间                     |

> 返回示例

> 成功

```json
{
  "Aid": 420000201412242240,
  "Gid": 330000200611062140,
  "Uid": 640000197301214500,
  "Uaccount": "#Wy$Z",
  "Atime": "2001-01-30 AM 10:50:10",
  "Abill": 20
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称       | 类型    | 必选 | 约束 | 说明 |
| ---------- | ------- | ---- | ---- | ---- |
| » Aid      | integer | true | none | none |
| » Gid      | integer | true | none | none |
| » Uid      | integer | true | none | none |
| » Uaccount | string  | true | none | none |
| » Atime    | string  | true | none | none |
| » Abill    | number  | true | none | none |

#### GET 订单收发货信息

GET /buy/account

##### 请求参数

| 名称  | 位置  | 类型   | 必选 | 说明            |
| ----- | ----- | ------ | ---- | --------------- |
| Aid   | query | string | 否   | 订单id	主键  |
| Gid   | query | string | 否   | 商品id	外键  |
| Uid   | query | string | 否   | 买家ID     外键 |
| Gname | query | string | 否   | none            |
| Guid  | query | string | 否   | 卖家id	外键  |
| Abill | query | string | 否   | none            |
| Atime | query | string | 否   | 交易时间        |

> 返回示例

> 成功

```json
{
  "Aid": 310000200107057600,
  "Gid": 140000199608028180,
  "Uid": 33000019740619504,
  "Gname": "Ume9",
  "Guid": 430000199101233900,
  "Abill": 40,
  "Atime": "1994-11-02 PM 22:06:03"
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称    | 类型    | 必选 | 约束 | 说明 |
| ------- | ------- | ---- | ---- | ---- |
| » Aid   | integer | true | none | none |
| » Gid   | integer | true | none | none |
| » Uid   | integer | true | none | none |
| » Gname | string  | true | none | none |
| » Guid  | integer | true | none | none |
| » Abill | number  | true | none | none |
| » Atime | string  | true | none | none |

#### DELETE 删除订单

DELETE /buy/account

##### 请求参数

| 名称 | 位置  | 类型   | 必选 | 说明   |
| ---- | ----- | ------ | ---- | ------ |
| Aid  | query | string | 否   | 订单id |

> 返回示例

> 成功

```json
{
  "Aid": 450000198607188160
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称  | 类型    | 必选 | 约束 | 说明 |
| ----- | ------- | ---- | ---- | ---- |
| » Aid | integer | true | none | none |

### 个人界面/个人信息界面/我的页面

#### GET 显示用户信息

GET /Person/account

##### 请求参数

| 名称      | 位置  | 类型   | 必选 | 说明               |
| --------- | ----- | ------ | ---- | ------------------ |
| Uid       | query | string | 否   | 主键，用户名       |
| Uphoto    | query | string | 否   | 头像，输入的是地址 |
| Unickname | query | string | 否   | 昵称               |
| Usex      | query | string | 否   | 性别，1  or 2      |
| Uschool   | query | string | 否   | 学校               |
| Utel      | query | string | 否   | 电话               |
| Uaddress  | query | string | 否   | 地址               |

> 返回示例

> 成功

```json
{
  "data": {
    "Uaccount": "41570",
    "Ubalance": 8756779593830006,
    "Uphoto": "http://dummyimage.com/120x90",
    "Unickname": "称",
    "Uhxid": "539502",
    "Upwd": "yJ&sJp4",
    "Utel": 18134525551,
    "Uaddress": "湖南省 娄底市 娄星区",
    "Uschool": "希望大学",
    "Usex": "男",
    "Ustate": true
  }
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称         | 类型    | 必选 | 约束 | 说明 |
| ------------ | ------- | ---- | ---- | ---- |
| » data       | object  | true | none | none |
| »» Uaccount  | string  | true | none | none |
| »» Upwd      | string  | true | none | none |
| »» Uhxid     | string  | true | none | none |
| »» Unickname | string  | true | none | none |
| »» Uphoto    | string  | true | none | none |
| »» Ubalance  | integer | true | none | none |
| »» Usex      | string  | true | none | 性别 |
| »» Uschool   | string  | true | none | none |
| »» Uaddress  | string  | true | none | none |
| »» Utel      | integer | true | none | none |
| »» Ustate    | boolean | true | none | none |

### 个人界面/个人信息界面/地址管理

#### POST 添加地址信息

POST /user/addAddress

> Body 请求参数

```yaml
Receiver: string
ReceiverPhone: string
Address: string
Username: string
AddressDetail: string
IsdefaultAddress: string

```

##### 请求参数

| 名称               | 位置 | 类型   | 必选 | 说明             |
| ------------------ | ---- | ------ | ---- | ---------------- |
| body               | body | object | 否   | none             |
| » Receiver         | body | string | 是   | 收货人           |
| » ReceiverPhone    | body | string | 是   | 收货手机号       |
| » Address          | body | string | 是   | 所在地区         |
| » Username         | body | string | 是   | 用户名           |
| » AddressDetail    | body | string | 是   | 具体地址         |
| » IsdefaultAddress | body | string | 是   | 是否设为默认地址 |

> 返回示例

> 成功

```json
{
  "data": true
}
```

> 失败

```json
{
  "data": false
}
```

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

状态码 **400**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

#### PUT 修改地址信息

PUT /user/changeAddress

> Body 请求参数

```yaml
Receiver: string
ReceiverPhone: string
Address: string
Username: string
AddressDetail: string
IsdefaultAddress: string
AddressID: string

```

##### 请求参数

| 名称               | 位置 | 类型   | 必选 | 说明             |
| ------------------ | ---- | ------ | ---- | ---------------- |
| body               | body | object | 否   | none             |
| » Receiver         | body | string | 是   | 收货人           |
| » ReceiverPhone    | body | string | 是   | 收货手机号       |
| » Address          | body | string | 是   | 所在地区         |
| » Username         | body | string | 是   | 用户名           |
| » AddressDetail    | body | string | 是   | 具体地址         |
| » IsdefaultAddress | body | string | 是   | 是否设为默认地址 |
| » AddressID        | body | string | 是   | 地址ID           |

> 返回示例

> 成功

```json
{
  "data": true
}
```

> 失败

```json
{
  "data": false
}
```

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

状态码 **400**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

#### DELETE 删除地址信息

DELETE /user/deleteAddress

##### 请求参数

| 名称      | 位置  | 类型   | 必选 | 说明   |
| --------- | ----- | ------ | ---- | ------ |
| AddressID | query | string | 是   | 地址ID |

> 返回示例

> 成功

```json
{
  "data": true
}
```

> 失败

```json
{
  "data": false
}
```

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

状态码 **400**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

#### GET 显示地址信息

GET /user/address

##### 请求参数

| 名称     | 位置  | 类型   | 必选 | 说明   |
| -------- | ----- | ------ | ---- | ------ |
| Username | query | string | 是   | 用户名 |

> 返回示例

> 成功

```json
{
  "data": {
    "AddressInfo": [
      {
        "AddressID": 1,
        "Receiver": "张三",
        "ReceiverPhone": "15727878399",
        "Address": "浙江省 杭州市 江干区",
        "AddressDetail": "白杨街道浙江工商大学钱江湾生活区",
        "IsdefaultAddress": true
      },
      {
        "AddressID": 2,
        "Receiver": "王五",
        "ReceiverPhone": " 16523838345",
        "Address": "浙江省 杭州市 江干区",
        "AddressDetail": "白杨街道浙江工商大学文科实验楼",
        "IsdefaultAddress": false
      }
    ]
  }
}
```

> 失败

```json
{
  "data": {}
}
```

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称                 | 类型     | 必选 | 约束 | 说明 |
| -------------------- | -------- | ---- | ---- | ---- |
| » data               | object   | true | none | none |
| »» AddressInfo       | [object] | true | none | none |
| »»» AddressID        | integer  | true | none | none |
| »»» Receiver         | string   | true | none | none |
| »»» ReceiverPhone    | string   | true | none | none |
| »»» Address          | string   | true | none | none |
| »»» AddressDetail    | string   | true | none | none |
| »»» IsdefaultAddress | boolean  | true | none | none |

状态码 **400**

| 名称   | 类型   | 必选 | 约束 | 说明 |
| ------ | ------ | ---- | ---- | ---- |
| » data | object | true | none | none |

### 个人界面/设置界面

#### PUT 修改头像

PUT /person/headphoto

> Body 请求参数

```yaml
Uid: string
Uphoto: string

```

##### 请求参数

| 名称     | 位置 | 类型   | 必选 | 说明         |
| -------- | ---- | ------ | ---- | ------------ |
| body     | body | object | 否   | none         |
| » Uid    | body | string | 是   | 用户id       |
| » Uphoto | body | string | 是   | 修改用户头像 |

> 返回示例

> 成功

```json
{
  "data": true
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

#### PUT 修改昵称

PUT /person/nickname

> Body 请求参数

```yaml
Uid: string
Unickname: string

```

##### 请求参数

| 名称        | 位置 | 类型   | 必选 | 说明         |
| ----------- | ---- | ------ | ---- | ------------ |
| body        | body | object | 否   | none         |
| » Uid       | body | string | 是   | 用户id       |
| » Unickname | body | string | 是   | 输入新的昵称 |

> 返回示例

> 成功

```json
{
  "data": true
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

### 个人界面/我的收藏

#### GET 收藏列表

GET /collect/mycollect

##### 请求参数

| 名称  | 位置  | 类型   | 必选 | 说明   |
| ----- | ----- | ------ | ---- | ------ |
| Colid | query | string | 否   | 收藏id |

> 返回示例

> 成功

```json
{
  "list": [
    {
      "Coltime": "2017-11-21 12:04:03",
      "Uid": "31",
      "Gid": 94,
      "Guid": "21"
    },
    {
      "Gid": 59,
      "Guid": "27",
      "Uid": "7",
      "Coltime": "2016-05-26 02:06:22"
    },
    {
      "Guid": "25",
      "Coltime": "2009-11-22 00:00:58",
      "Gid": 87,
      "Uid": "75"
    },
    {
      "Guid": "85",
      "Uid": "40",
      "Gid": 73,
      "Coltime": "2001-03-16 14:49:53"
    }
  ]
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称       | 类型     | 必选  | 约束 | 说明 |
| ---------- | -------- | ----- | ---- | ---- |
| » list     | [object] | true  | none | none |
| »» Gid     | integer  | false | none | none |
| »» Uid     | string   | false | none | none |
| »» Guid    | string   | false | none | none |
| »» Coltime | string   | false | none | none |

#### POST 添加收藏

POST /collect/getcollect

##### 请求参数

| 名称  | 位置  | 类型   | 必选 | 说明   |
| ----- | ----- | ------ | ---- | ------ |
| Colid | query | string | 否   | 收藏id |

> 返回示例

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称       | 类型     | 必选  | 约束 | 说明 |
| ---------- | -------- | ----- | ---- | ---- |
| » list     | [object] | true  | none | none |
| »» Gid     | integer  | false | none | none |
| »» Uid     | string   | false | none | none |
| »» Guid    | string   | false | none | none |
| »» Coltime | string   | false | none | none |

#### DELETE 删除收藏

DELETE /collect/collect

##### 请求参数

| 名称  | 位置  | 类型   | 必选 | 说明   |
| ----- | ----- | ------ | ---- | ------ |
| Colid | query | string | 否   | 收藏id |

> 返回示例

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称       | 类型     | 必选  | 约束 | 说明 |
| ---------- | -------- | ----- | ---- | ---- |
| » list     | [object] | true  | none | none |
| »» Gid     | integer  | false | none | none |
| »» Uid     | string   | false | none | none |
| »» Guid    | string   | false | none | none |
| »» Coltime | string   | false | none | none |

### 个人界面/订单签收

#### PUT 确认收货

PUT /account/account

##### 请求参数

| 名称    | 位置  | 类型   | 必选 | 说明   |
| ------- | ----- | ------ | ---- | ------ |
| OrderID | query | string | 是   | 订单ID |

> 返回示例

> 成功

```json
{
  "data": true
}
```

> 失败

```json
{
  "data": false
}
```

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

状态码 **400**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

### 发布界面/发布地址

#### PUT 修改地址信息

PUT /person/address

> Body 请求参数

```yaml
Receiver: string
ReceiverPhone: string
Address: string
Username: string
AddressDetail: string
IsdefaultAddress: string
AddressID: string

```

##### 请求参数

| 名称               | 位置 | 类型   | 必选 | 说明             |
| ------------------ | ---- | ------ | ---- | ---------------- |
| body               | body | object | 否   | none             |
| » Receiver         | body | string | 是   | 收货人           |
| » ReceiverPhone    | body | string | 是   | 收货手机号       |
| » Address          | body | string | 是   | 所在地区         |
| » Username         | body | string | 是   | 用户名           |
| » AddressDetail    | body | string | 是   | 具体地址         |
| » IsdefaultAddress | body | string | 是   | 是否设为默认地址 |
| » AddressID        | body | string | 是   | 地址ID           |

> 返回示例

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型    | 必选 | 约束 | 中文名 | 说明 |
| ------ | ------- | ---- | ---- | ------ | ---- |
| » data | boolean | true | none |        | none |

状态码 **400**

| 名称   | 类型    | 必选 | 约束 | 中文名 | 说明 |
| ------ | ------- | ---- | ---- | ------ | ---- |
| » data | boolean | true | none |        | none |

#### DELETE 删除地址信息

DELETE /person/address

##### 请求参数

| 名称      | 位置  | 类型   | 必选 | 说明   |
| --------- | ----- | ------ | ---- | ------ |
| AddressID | query | string | 是   | 地址ID |

> 返回示例

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型    | 必选 | 约束 | 中文名 | 说明 |
| ------ | ------- | ---- | ---- | ------ | ---- |
| » data | boolean | true | none |        | none |

状态码 **400**

| 名称   | 类型    | 必选 | 约束 | 中文名 | 说明 |
| ------ | ------- | ---- | ---- | ------ | ---- |
| » data | boolean | true | none |        | none |

#### GET 显示地址信息

GET /person/address

##### 请求参数

| 名称     | 位置  | 类型   | 必选 | 说明   |
| -------- | ----- | ------ | ---- | ------ |
| Username | query | string | 是   | 用户名 |

> 返回示例

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称                 | 类型     | 必选 | 约束 | 中文名 | 说明 |
| -------------------- | -------- | ---- | ---- | ------ | ---- |
| » data               | object   | true | none |        | none |
| »» AddressInfo       | [object] | true | none |        | none |
| »»» AddressID        | integer  | true | none |        | none |
| »»» Receiver         | string   | true | none |        | none |
| »»» ReceiverPhone    | string   | true | none |        | none |
| »»» Address          | string   | true | none |        | none |
| »»» AddressDetail    | string   | true | none |        | none |
| »»» IsdefaultAddress | boolean  | true | none |        | none |

状态码 **400**

| 名称   | 类型   | 必选 | 约束 | 中文名 | 说明 |
| ------ | ------ | ---- | ---- | ------ | ---- |
| » data | object | true | none |        | none |

#### POST 添加地址信息

POST /person/address

> Body 请求参数

```yaml
Receiver: string
ReceiverPhone: string
Address: string
Username: string
AddressDetail: string
IsdefaultAddress: string

```

##### 请求参数

| 名称               | 位置 | 类型   | 必选 | 说明             |
| ------------------ | ---- | ------ | ---- | ---------------- |
| body               | body | object | 否   | none             |
| » Receiver         | body | string | 是   | 收货人           |
| » ReceiverPhone    | body | string | 是   | 收货手机号       |
| » Address          | body | string | 是   | 所在地区         |
| » Username         | body | string | 是   | 用户名           |
| » AddressDetail    | body | string | 是   | 具体地址         |
| » IsdefaultAddress | body | string | 是   | 是否设为默认地址 |

> 返回示例

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型    | 必选 | 约束 | 中文名 | 说明 |
| ------ | ------- | ---- | ---- | ------ | ---- |
| » data | boolean | true | none |        | none |

状态码 **400**

| 名称   | 类型    | 必选 | 约束 | 中文名 | 说明 |
| ------ | ------- | ---- | ---- | ------ | ---- |
| » data | boolean | true | none |        | none |

### 聊天界面/聊天消息

#### GET 显示聊天记录

GET /message/getmessage

> Body 请求参数

```yaml
Username: string
OtherUser: string

```

##### 请求参数

| 名称        | 位置 | 类型   | 必选 | 说明           |
| ----------- | ---- | ------ | ---- | -------------- |
| body        | body | object | 否   | none           |
| » Username  | body | string | 是   | 聊天一方用户   |
| » OtherUser | body | string | 是   | 聊天另一方用户 |

> 返回示例

> 成功

```json
{
  "data": {
    "list": [
      {
        "Avatar": "https://siwneiwnbreb",
        "Message": "请问还有多长时间发货呢~"
      },
      {
        "Avatar": "https://siwneiwderhenbreb",
        "Message": "好的，三天内为您发货"
      }
    ]
  }
}
```

> 失败

```json
{
  "data": {}
}
```

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称        | 类型     | 必选 | 约束 | 说明 |
| ----------- | -------- | ---- | ---- | ---- |
| » data      | object   | true | none | none |
| »» list     | [object] | true | none | none |
| »»» Avatar  | string   | true | none | none |
| »»» Message | string   | true | none | none |

状态码 **400**

| 名称   | 类型   | 必选 | 约束 | 说明 |
| ------ | ------ | ---- | ---- | ---- |
| » data | object | true | none | none |

#### POST 修改消息状态

POST /message/changemessage

> Body 请求参数

```yaml
mid: string
Message: string

```

##### 请求参数

| 名称      | 位置 | 类型   | 必选 | 说明   |
| --------- | ---- | ------ | ---- | ------ |
| body      | body | object | 否   | none   |
| » mid     | body | string | 是   | 用户id |
| » Message | body | string | 是   | 消息   |

> 返回示例

> 成功

```json
{
  "data": true
}
```

> 失败

```json
{
  "data": false
}
```

##### 返回结果

| 状态码 | 状态码含义                                                   | 说明 | 数据模型 |
| ------ | ------------------------------------------------------------ | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1)      | 成功 | Inline   |
| 400    | [Bad Request](https://tools.ietf.org/html/rfc7231#section-6.5.1) | 失败 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

状态码 **400**

| 名称   | 类型    | 必选 | 约束 | 说明 |
| ------ | ------- | ---- | ---- | ---- |
| » data | boolean | true | none | none |

### 公益

#### GET 公益列表

GET /charity/indexCharity

##### 请求参数

| 名称       | 位置  | 类型   | 必选 | 说明             |
| ---------- | ----- | ------ | ---- | ---------------- |
| uid        | query | string | 否   | 参加人id	外键 |
| account    | query | string | 否   | none             |
| nickname   | query | string | 否   | none             |
| raputation | query | string | 否   | none             |
| tel        | query | string | 否   | none             |
| hxid       | query | string | 否   | none             |
| cid        | query | string | 否   | none             |
| cname      | query | string | 否   | none             |
| cdetail    | query | string | 否   | none             |
| cneed      | query | string | 否   | none             |
| cnumber    | query | string | 否   | none             |
| ctime      | query | string | 否   | none             |
| cdeadline  | query | string | 否   | none             |
| ctype      | query | string | 否   | none             |
| caddress   | query | string | 否   | none             |
| cscannum   | query | string | 否   | none             |
| cjoinnum   | query | string | 否   | none             |
| cstate     | query | string | 否   | none             |
| cimage     | query | string | 否   | none             |
| headphoto  | query | string | 否   | none             |

> 返回示例

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

#### GET 公益状态

GET /charity/getcharity

设置公益状态

##### 请求参数

| 名称      | 位置  | 类型   | 必选 | 说明                                                |
| --------- | ----- | ------ | ---- | --------------------------------------------------- |
| cname     | query | string | 否   | 公益名称                                            |
| cstate    | query | string | 否   | 公益状态，1表示在进行中，2表示失效，3表示用户已删除 |
| cdetail   | query | string | 否   | 详情说明                                            |
| cneed     | query | string | 否   | 公益需求                                            |
| nickname  | query | string | 否   | 用户昵称                                            |
| caddress  | query | string | 否   | 发布地址                                            |
| ctime     | query | string | 否   | 发布时间                                            |
| cdeadline | query | string | 否   | 截止时间                                            |
| cscannum  | query | string | 否   | 浏览人数                                            |
| cjoinnum  | query | string | 否   | 参观人数                                            |

> 返回示例

> 成功

```json
{
  "cname": "曾明",
  "cstate": 1,
  "cneed": "没有额外需求",
  "cdetail": "捐款10元",
  "nickname": "小明",
  "caddress": "浙江工商大学",
  "ctime": "12:43:02",
  "cdeadline": "14:03:56",
  "cscannum": 10,
  "cjoinnum": 20
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称        | 类型    | 必选 | 约束 | 说明 |
| ----------- | ------- | ---- | ---- | ---- |
| » cname     | string  | true | none | none |
| » cstate    | integer | true | none | none |
| » cdetail   | string  | true | none | none |
| » cneed     | string  | true | none | none |
| » nickname  | string  | true | none | none |
| » caddress  | string  | true | none | none |
| » ctime     | string  | true | none | none |
| » cdeadline | string  | true | none | none |
| » cscannum  | integer | true | none | none |
| » cjoinnum  | integer | true | none | none |

#### PUT 加入公益

PUT /charity/joincharity

##### 请求参数

| 名称  | 位置  | 类型   | 必选 | 说明             |
| ----- | ----- | ------ | ---- | ---------------- |
| cid   | query | string | 否   | 主键，公益ID     |
| cuid  | query | string | 否   | 外键，发起人的ID |
| jtime | query | string | 否   | 参加时间         |

> 返回示例

> 成功

```json
{
  "cid": "捐款",
  "cuid": "小明",
  "jtime": "15:59:04"
}
```

##### 返回结果

| 状态码 | 状态码含义                                              | 说明 | 数据模型 |
| ------ | ------------------------------------------------------- | ---- | -------- |
| 200    | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功 | Inline   |

##### 返回数据结构

状态码 **200**

| 名称    | 类型   | 必选 | 约束 | 说明 |
| ------- | ------ | ---- | ---- | ---- |
| » cid   | string | true | none | none |
| » cuid  | string | true | none | none |
| » jtime | string | true | none | none |

#### 数据模型



## 使用和测试方法

本地 mock 服务

Mock 功能可以根据接口/数据结构定义、Mock规则配置、Mock 期望配置，自动生成模拟数据，且使用者可以根据需要灵活构造各种结构的接口数据。

接口测试用例：设计好接口文档后，就可以直接运行接口来调试了

## 接口运行

我们组可以在接口详情里的 运行 界面，来临时调试接口，运行 完后，我们可以保存为用例，这样能将填写的 参数值等信息保存下来；否则关闭 tab 后，这些信息将会丢失。保存为用例是将当前填写的参数保存起来，方便下次或者其他人用来调试接口，后续用接口用例来调试接口是非常高效的。

保存为用例后，接口用例会显示在左侧树状菜单里接口的下一级。

# 五、数据库设计 [陈嘉诚]

## 数据库设计说明

数据库是在计算机中按照数据的格式来组织、储存和管理数据的数据仓库。在本系统中数据库创建在服务端，用于存储用户数据、商品数据和订单数据等。

目前常用的数据库工具及其优缺点的对比如表所示：

| 数据库    | 优点                                                         | 缺点                                         |
| --------- | ------------------------------------------------------------ | -------------------------------------------- |
| Access    | 储存方式简单，便于维护管理。                                 | 不适合高并发访问。                           |
| MySQL     | 安装方便，使用及学习成本较低，功能完善。                     | MySQL的密码容易被破解，安全性较差。          |
| SQLServer | 相比于MySQL的安全性更高，存储数据的伸缩性也更好，可以在不同的系统平台使用。 | 数据操作相比于其他的数据库操作变的更加复杂。 |
| Oracle    | 处理数据速度快，安全性较高，可以使用多台数据库做集群数据库，实现短时间内转移数据。 | 其产品付费才能使用，增加了系统的运行成本。   |

通过表中对各个数据库的优缺点进行分析，可以看出MySQL数据库是在以上几个数据库中最合适的一个，其体积小、响应速度快的特点使得更加方便的安装和使用，大大降低了本系统的开发和维护成本。（核心：MySQL免费）

## 数据表说明

本项目的设计所用的数据库为MySQL，主要应用于服务端进行用户及商品数据的储存。数据库中建立的表有用户表（user）、商品表（goods）、公益表（charity）、求购表（buy）、订单表（account）、商品评论表（conments）、求购评论表（buyconments）、商品收藏表（collect）、参加公益名单表（joincharity）、系统消息表（message）、环信token表（token），具体如下所示：

（1）用户表（user）的属性如下表3-1所示:

表3-1 用户表（user）属性

| 列名        | 数据类型 | 数据大小 | 说明                              | 约束               |
| ----------- | -------- | -------- | --------------------------------- | :----------------- |
| Uid         | int      | 11       | 用户id                            | 主键               |
| Uaccount    | varchar  | 18       | 账号                              |                    |
| Upwd        | varchar  | 18       | 密码                              | 只能包含数字和字母 |
| Uhxid       | varchar  | 18       | 环信id                            |                    |
| Unickname   | varchar  | 18       | 昵称                              |                    |
| Uphoto      | varchar  | 100      | 头像存储路径                      |                    |
| Ubalance    | double   | 100      | 账户余额                          | 保留小数点后两位   |
| Usex        | int      | 1        | 性别                              | 1 or 2             |
| Uschool     | varchar  | 100      | 学校                              |                    |
| Uaddress    | varchar  | 255      | 地址                              |                    |
| Ureputation | int      | 4        | 信誉值                            |                    |
| Utel        | varchar  | 11       | 电话                              |                    |
| Ustate      | int      | 1        | 登录状态,1表示未登录，2表示已登录 | 1    or 2          |

（2）商品表（goods）的属性如下表3-2所示:

表3-2 商品表（goods）属性

| 列名      | 数据类型 | 数据大小 | 说明                                                         | 约束             |
| --------- | -------- | -------- | ------------------------------------------------------------ | ---------------- |
| Gid       | int      | 11       | 商品id                                                       | 主键             |
| Gname     | varchar  | 18       | 商品名                                                       |                  |
| Uid       | int      | 11       | 卖家id                                                       | 外键             |
| Gtime     | varchar  | 20       | 发布时间                                                     |                  |
| Gtype     | varchar  | 6        | 商品类型                                                     |                  |
| Gdetail   | varchar  | 255      | 商品描述                                                     |                  |
| Gprice    | double   | 100      | 商品价格                                                     | 保留小数点后两位 |
| Goprice   | double   | 100      | 商品原价                                                     | 保留小数点后两位 |
| Gimage    | varchar  | 100      | 商品图片存储路径                                             |                  |
| Gstate    | int      | 1        | 商品状态，1表示在售，2表示在交易中，3表示交易成功,4表示交易失败，5表示已删除 |                  |
| Gemergent | int      | 1        | 是否急售，1表示正常，2表示急售                               | 1 or 2           |
| Ggetway   | varchar  | 10       | 交易方式，邮寄或自提                                         |                  |
| Ghownew   | varchar  | 10       | 新旧程度                                                     |                  |
| Gscannum  | int      | 11       | 浏览人数                                                     |                  |
| Gaddress  | varchar  | 18       | 发布地址                                                     |                  |

（3）公益表（charity）的属性如下表3-3所示:

表3-3 公益表（charity）属性

| 列名      | 数据类型 | 数据大小 | 说明                                                | 约束 |
| --------- | -------- | -------- | --------------------------------------------------- | ---- |
| Cid       | int      | 11       | 公益id                                              | 主键 |
| Cname     | varchar  | 18       | 公益名称                                            |      |
| Uid       | int      | 11       | 发起人id                                            | 外键 |
| Cimage    | varchar  | 100      | 公益图片存储路径                                    |      |
| Cdetail   | varchar  | 255      | 公益描述                                            |      |
| Cneed     | varchar  | 255      | 公益需求                                            |      |
| Cnumber   | int      | 11       | 需求人数                                            |      |
| Ctime     | varchar  | 20       | 发起时间                                            |      |
| Cdeadline | varchar  | 20       | 截止时间                                            |      |
| Ctype     | varchar  | 6        | 报名方式，线下或线上                                |      |
| Caddress  | varchar  | 18       | 发布地址                                            |      |
| Cscannum  | int      | 11       | 浏览人数                                            |      |
| Cjoinnum  | int      | 11       | 参加人数                                            |      |
| Cstate    | int      | 1        | 公益状态，1表示在进行中，2表示失效，3表示用户已删除 |      |

（4）求购表（buy）的属性如下表3-4所示:

表3-4 求购表（buy）属性

| 列名     | 数据类型 | 数据大小 | 说明                                  | 约束             |
| -------- | -------- | -------- | ------------------------------------- | ---------------- |
| Bid      | int      | 11       | 求购id                                | 主键             |
| Bname    | varchar  | 18       | 求购名称                              |                  |
| Uid      | int      | 11       | 发布人id                              | 外键             |
| Bdetail  | varchar  | 255      | 求购介绍                              |                  |
| Bsprice  | double   | 10       | 最低价                                | 保留小数点后两位 |
| Bbprice  | double   | 10       | 最高价                                | 保留小数点后两位 |
| Btype    | varchar  | 10       | 求购类型                              |                  |
| Bhownew  | varchar  | 10       | 新旧程度                              |                  |
| Bgetway  | varchar  | 10       | 交易方式                              |                  |
| Baddress | varchar  | 18       | 发布地址                              |                  |
| Btime    | varchar  | 20       | 发布时间                              |                  |
| Bimage   | varchar  | 100      | 求购图片                              |                  |
| Bstate   | int      | 1        | 求购状态，1求购状态，2求购到，3已删除 |                  |
| Bscannum | int      | 11       | 浏览人数                              |                  |

（5）订单表（account）的属性如下表3-5所示:

表3-5订单表（account）属性

| 列名    | 数据类型 | 数据大小 | 说明                                                         | 约束             |
| ------- | -------- | -------- | ------------------------------------------------------------ | ---------------- |
| Aid     | int      | 11       | 订单id                                                       | 主键             |
| Anumber | varchar  | 100      | 订单号                                                       |                  |
| Gid     | int      | 11       | 商品id                                                       | 外键             |
| Uid     | int      | 11       | 买家id                                                       | 外键             |
| Guid    | int      | 11       | 卖家id                                                       | 外键             |
| Abill   | double   | 10       | 订单金额                                                     | 保留小数点后两位 |
| Atime   | varchar  | 20       | 交易时间                                                     |                  |
| Astate  | int      | 1        | 订单状态，1表示等待卖家发货，2表示等待买家收货，3表示交易成功，4表示退款中，5表示交易失败（取消订单），6表示订单删除 |                  |

（6）商品评论表（conments）的属性如下表3-6所示:

表3-6 商品评论表（conments）属性

| 列名       | 数据类型 | 数据大小 | 说明                             | 约束   |
| ---------- | -------- | -------- | -------------------------------- | ------ |
| Conid      | int      | 11       | 评论id                           | 主键   |
| Gid        | int      | 11       | 商品id                           | 外键   |
| Uid        | int      | 11       | 评论人id                         | 外键   |
| Guid       | int      | 11       | 卖家id                           | 外键   |
| Contime    | varchar  | 20       | 评论时间                         |        |
| Concontent | varchar  | 255      | 评论内容                         |        |
| Constate   | int      | 1        | 评论状态，1表示存在，2表示已删除 | 1 or 2 |

（7）求购评论表（buyconments）的属性如下表3-7所示:

表3-7 求购评论表（buyconments）属性

| 列名        | 数据类型 | 数据大小 | 说明                             | 约束   |
| ----------- | -------- | -------- | -------------------------------- | ------ |
| Bconid      | int      | 11       | 评论id                           | 主键   |
| Bid         | int      | 11       | 求购id                           | 外键   |
| Uid         | int      | 11       | 评论人id                         | 外键   |
| Buid        | int      | 11       | 求购人id                         | 外键   |
| Bcontime    | varchar  | 20       | 评论时间                         |        |
| Bconcontent | varchar  | 255      | 评论内容                         |        |
| Bconstate   | int      | 1        | 评论状态，1表示存在，2表示已删除 | 1 or 2 |

（8）商品收藏表（collect）的属性如下表3-8所示:

表3-8 商品收藏表（collect）属性

| 列名    | 数据类型 | 数据大小 | 说明     | 约束 |
| ------- | -------- | -------- | -------- | ---- |
| Colid   | int      | 11       | 收藏id   | 主键 |
| Gid     | int      | 11       | 商品id   | 外键 |
| Uid     | int      | 11       | 收藏人id | 外键 |
| Guid    | int      | 11       | 卖家id   | 外键 |
| Coltime | varchar  | 20       | 收藏时间 |      |

 

（9）参加公益名单表（joincharity）的属性如下表3-9所示:

表3-9 参加公益名单表（joincharity）属性

| 列名  | 数据类型 | 数据大小 | 说明     | 约束 |
| ----- | -------- | -------- | -------- | ---- |
| Jid   | int      | 11       | 名单id   | 主键 |
| Cid   | int      | 11       | 公益id   | 外键 |
| Uid   | int      | 11       | 参加人id | 外键 |
| Cuid  | int      | 11       | 发起人id | 外键 |
| Jtime | varchar  | 20       | 参加时间 |      |

（10）系统消息表（message）的属性如下表3-10所示:

表3-10 系统消息表（message）属性

| 列名      | 数据类型 | 数据大小 | 说明                                              | 约束 |
| --------- | -------- | -------- | ------------------------------------------------- | ---- |
| Mid       | int      | 11       | 消息id                                            | 主键 |
| Receiveid | int      | 11       | 接收人id                                          | 外键 |
| Mtitle    | varchar  | 20       | 消息标题                                          |      |
| Mcontent  | varchar  | 255      | 消息内容                                          |      |
| Mtime     | varchar  | 20       | 消息时间                                          |      |
| Mstate    | int      | 1        | 消息状态，1表示未读，2表示已读，3表示该消息已删除 |      |

（11）环信token表（token）的属性如下表3-11所示:  

表3-11 环信token表（token）属性

| 列名        | 数据类型 | 数据大小 | 说明                           | 约束 |
| ----------- | -------- | -------- | ------------------------------ | ---- |
| id          | int      | 11       | Token id                       | 主键 |
| apptoken    | varchar  | 255      | 环信token                      |      |
| expires     | varchar  | 20       | 有效时间，在有效时间内不去获取 |      |
| application | varchar  | 255      | 应用码                         |      |

其中，用户表（user）`、商品表（goods）、公益表（charity）需要做持久化处理，购买表（buy、求购评论表（buyconments）、订单表（account）、商品评论表（conments）以及消息对话表（message）需要做缓存redis处理。

## E-R图说明

<img src="G:\大三课程\移动互联开发实战\绘图1.png" alt="绘图1" style="zoom:67%;" />

## 技术说明

在数据库的建立中没有使用什么特别的技术，使用了Navicat Premuim 15作为MySQL的管理工具，在其中按照正常的数据库建立逻辑创建好了数据库。

与后端相关的技术使用了MyBatis，别的没有什么技术上的实现。

# 六、安卓端的实现 [徐晨凯、靳洋洋]

## 6.1用户管理模块

（代码部分参考https://b23.tv/sUNJuP6项目的前端代码)

### 6.1.1 注册登录

 为保证客户端数据的准确性，用户首次使用客户端时必须进行注册账号再登录才可进入客户端。其中，用户注册登录的界面布局分别如图6-1和6-2所示。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081428703.png" alt="image-20220610081428703" style="zoom:67%;" />

​                                                                                                                       图6-1 注册界面布局

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081448657.png" alt="image-20220610081448657" style="zoom:67%;" />

​                                                                                                                  图6-2 登录界面布局

 在用户注册时，可以先自己填个账号，作为此后登录APP的账号。填写完，点击注册，安卓端生成json数据，如{“account”:“用户名”，“password”:“密码”，“nickname”:“昵称”，“tel”:“电话”，“sex”：“性别”}，由安卓端向服务端发起POST请求，同时将生成的json数据上传到服务端，等服务端验证完成后安卓端会收到返回的数据，安卓端再根据返回数据执行相应的逻辑代码。如果账号已注册，客户端会提示用户账号存在，否则，账号注册成功，安卓端会直接切换到登录界面。


```java
 //发起http请求的网址
         String strUrlpath = getResources().getString(R.string.burl) + "Signup_Servlet";
         System.out.println("输出为：" + params);
         //发起http的POST请求，把用户数据发送到服务器并接收返回的数据
         String Result = HttpUtils.submitPostData(strUrlpath, params, "utf-8");
         System.out.println("结果为：" + Result);
 
         //message处理
         Message message = new Message();
         message.what = 1;
         message.obj = Result;
         handler.sendMessage(message);
```

在用户注册及登录过程中都需要客户端向服务端发起http请求，以下对其流程进行介绍：

客户端发起网络请求时，首先设置URL的格式为“http://[服务器ip]:[服务器端口]/项目名/相应的Servlet/用户数据”，之后设置请求时间为1000ms，请求类型为POST或GET，上传的json数据写入请求体中并设置请求体的长度，打开请求的输出流向服务端发起请求，之后就等待本次网络请求的输入流，将服务端返回的请求体数据流转换成String并对其进一步解析，获取到服务端返回的数据，一次http请求完成。

```java
 //将输入的账号密码拼接成params
     Map<String, String> params = new HashMap<String, String>();
     params.put("account", et_logic_account.getText().toString().trim());
     params.put("password", et_logic_pwd.getText().toString().trim());
     //设置访问网址
     String strUrlPath = getResources().getString(R.string.burl) + "Login_Servlet";
     System.out.println("输出为：" + params);
     //发起http请求
     String Result = HttpUtils.submitPostData(strUrlPath, params, "utf-8");
     System.out.println("结果为：" + Result);

    //请求结果的message处理
      Message message = new Message();
      message.what = 0;
      message.obj = Result;
      handler.sendMessage(message);
```



### 6.1.2 用户资料修改

（1）个人资料修改

 登录之后通过“我的-个人资料”进入个人详情页查看详细信息，可以修改。用户的个人数据在本地数据库和服务端的数据库中，一次在客户端使用个人资料时会优先选择本地数据库的数据，避免大量的网络请求。同时，服务端的数据库中数据变化时也会更新本地数据，保证数据的一致，如图所示。 

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081547204.png" alt="image-20220610081547204" style="zoom:67%;" />

​                                                                                                                          个人资料

（2）头像修改

点击“头像”一栏后会弹出图片选取方式的选择框，如图4-8所示。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081603745.png" alt="image-20220610081603745" style="zoom:67%;" />



​                                                                                                                      更换头像选择框

选择拍照或从相册选择都能获取到图片，获取到图片后会对图片进行裁剪，并将裁剪后的jpg文件解析成Bitmap（位图文件）对象并进行压缩，再经过Base64编码，将Bitmap对象转换成String类型对象，生成更改头像的json数据，并向服务端的Mycenter_Servlet发起http请求，等待服务端返回头像修改成功的数据和头像在服务端的存储路径。修改成功后客户端会把头像在服务端的储存路径存入本地数据库，便于下次使用头像时获取。Base64是常用的数据加密算法，可用于8Bit（比特）字节代码的编码[20]，并且其编码后的数据具有不可读性，在一定程度上保护了数据，起到一定的加密作用。使用Base64编码的长数据适合在http环境下传输，因此在理论上其特别适合图片数据的传输。在服务端同样使用了该算法对上传的图片数据进行解码，将String对象转成Bitmap对象。首先创建一个空的输出流实例image，将Bitmap对象压缩后传给image，再将image对象转换成8Bit的字节码datas，通过Base64实现对8Bit字节码的编码，将编码后的数据返回。

（3）密码修改

在我们的日常使用中，修改密码是一个必不可少的功能，而我们的app也实现了这一功能。点击“我的-设置-修改密码”后，如图所示，输入要改的密码，点击确定实现密码的修改。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081619763.png" alt="image-20220610081619763" style="zoom:67%;" />

​                                                                                                                          修改密码窗口

## 6.2发布与检索模块

（代码部分参考https://b23.tv/sUNJuP6项目的前端代码)

发布和搜索模块是核心模块。在安卓端中，用户可以发布商品、发布免费送、发布求购和发起公益，搜索功能包括主页面的搜索窗口、分类查看商品、主页直接浏览猜你喜欢和查看附近商品，用户有很多的方式来寻找他想要的商品。

### 6.2.1 发布功能

（1）发布闲置

上传商品信息我定义一个publish方法，然后用Toast.makeText来获取信息，然后用params.put方法来设置数据，把商品信息上传。

发布闲置功能是我们app中很重要的一个功能，可以说是我们系统的核心功能了。界面如图所示。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081634839.png" alt="image-20220610081634839" style="zoom:67%;" />

​                                                                                                                         商品发布界面

如图所示，发布界面的布局整体是一个RelativeLayout（相关布局），布局中包括了顶部的标题栏、ImageView、EditText、TextView、Spinner、CheckBox等控件。点击顶部的“相机”图片实现图片的添加，然后输入商品的名称、具体信息、价格等信息。类型的选择需点击“类型”，选择自己商品的类型，一共有手机数码等十三种商品分类。新旧程度点开后会有十成新等供用户选择。商品的发货方式可以设置为邮寄或自提，状态可选择加急，选择之后商品将作为急售商品出售。最下面就是商品的发货地点，我们安卓端中集成了百度地图的SDK，因此发货地点可通过定位实现，也可以点击“发货地”一栏自己选择商品的发货地，地址选择界面如图4-12所示。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081658010.png" alt="image-20220610081658010" style="zoom:67%;" />

​                                                                                                                       地址选择界面

 

地址选择部分我引入了百度地图sdk，百度地图Android定位SDK是为Android移动端应用提供的一套简单易用的定位服务接口，专注于为广大开发者提供最好的综合定位服务。通过使用百度定位SDK，开发者可以轻松为应用程序实现智能、精准、高效的定位功能。

这是我的百度地图sdk引入：

先新建了一个应用

 <img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081725364.png" alt="image-20220610081725364" style="zoom:67%;" />

然后在安卓端的AndroidManifest.xml文件中加入，重新编译之后可以使用。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081744990.png" alt="image-20220610081744990" style="zoom:67%;" />

 

 

填写完商品的基本数据，点击右上角的“√”即可完成商品的发布，商品发布的流程图如图所示。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081800726.png" alt="image-20220610081800726" style="zoom:67%;" />

 

​                                                                                                               商品发布流程图

发布免费送商品流程和发布闲置类似，不同的是免费送商品发布的商品没有商品价格和加急功能。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081815255.png" alt="image-20220610081815255" style="zoom:67%;" />

（2）发布求购

很多二手商品交易平台还没有发布求购信息的功能。很多同学真正需要的商品可能市场上没有但他们没有途径去发布他们求购的信息，我们的软件结合广大同学对求购功能的需求加入了发布求购信息的功能，发布求购界面如图所示。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081839908.png" alt="image-20220610081839908" style="zoom:67%;" />

​                                                                                                                          发布求购界面

发布求购的界面与发布闲置商品的界面类似，相对之前的发布闲置商品功能，我们求购信息没有了商品的价格和原价，加入了用户对于求购商品的最低价和最高价，其他信息基本相同。

（3）发起公益

为了呼吁大家一起做志愿公益，我们引入了公益模块，发起公益活动的layout布局如图所示。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081858115.png" alt="image-20220610081858115" style="zoom:67%;" />                                                                                                                    

发起公益布局

发起一个公益活动，我们一般需要填写公益活动的图片、标题、需求等信息，信息越详细越好。



### 6.2.2 商品检索及浏览

（1）关键词检索

这是搜索点击功能的实现

```java
case R.id.iv_f1_search:
   if("".equals(et_f1_search.getText().toString().trim())){
     Toast.makeText(QTApplication.getmContext(), "请输入要搜索的商品哦！", Toast.LENGTH_LONG).show();
   }else {
     Intent searchIntent = new Intent(getActivity(), GoodsListActivity.class);
     searchIntent.putExtra("searchType", "goodsName");
     searchIntent.putExtra("goodsType", et_f1_search.getText().toString().trim());
     startActivity(searchIntent);
     et_f1_search.setText("");
   }
   break;
```

对于目前市场上大多数的App来说搜索功能是一个必不可少的功能，对于二手交易平台来说更是一个必要的功能，因此本客户端中最重要的检索方式就是通过商品的关键词进行搜索。其中客户端首页界面如图所示。



<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081936803.png" alt="image-20220610081936803" style="zoom:67%;" />                                                                       

  客户端首页

如图4-16所示，客户端首页加入了SwipeRefreshLayout（下拉刷新控件），下拉页面即可实现客户端商品数据的更新。同时，通过客户端首页的搜索框输入关键词，就能够搜索到相关商品。其搜索结果将会通过商品列表展示出来，如图4-17所示。点击商品列表中的商品可以查看商品详情，其商品详情界面如图4-18所示。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081958470.png" alt="image-20220610081958470" style="zoom:67%;" />

 

​                                                                                                             图4-17 商品搜索列表界面

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082015477.png" alt="image-20220610082015477" style="zoom:67%;" />

 

​                                                                                                                     图4-18 商品详情

商品列表采用RecyclerView（循环视图）布局作为商品列表的父布局，并通过相应的Adapter（适配器）显示搜索到的商品信息，将多条商品信息显示到RecyclerView中。在本客户端中，所有图片的加载均采用了Glide图片加载库，如商品图片及用户头像的加载。

（2）分类检索

分类检索的处理逻辑较为简单，先初始化各分类模块，然后返回按钮的监听和各个分类模块的监听，然后完成点击事件的逻辑处理。

 根据商品分类，用户可以检索相同类别的商品。分类检索的入口可以在主页面的商品分类查看部分分类，同时也可以通过点击全部查看商品的全部分类，其全部分类界面如图4-19所示。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082036457.png" alt="image-20220610082036457" style="zoom:67%;" />

​                                                                                                                    图4-19 商品分类界面

商品分类界面中显示了系统中比较火爆的三个商品类别，并且客户端的商品分类涵盖了日常生活大部分的商品，对于没有的分类，可选择其他商品。

（3）浏览公益

 浏览公益对应之前的发布公益。因此为了能让更多的用户注意公益，在客户端首页加入了公益的入口，用户可通过首页的公益入口浏览客户端中的公益列表，并且在公益详情中可以参加相应的公益，公益详情界面如图所示

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082048356.png" alt="image-20220610082048356" style="zoom:67%;" />

​                                                                                                                    图4-21 公益详情

在公益详情界面显示公益的图片、名称等重要信息，同样还显示活动发起人和参与人数。为了方便用户与活动发起人的交流，在公益详情界面还可以联系发起人。

 

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082104653.png" alt="image-20220610082104653" style="zoom:67%;" />

我们项目的聊天功能，引入了环信，客户端集成了环信的SDK用于实现用户的聊天通信，

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082127485.png" alt="image-20220610082127485" style="zoom:67%;" />

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082140941.png" alt="image-20220610082140941" style="zoom:67%;" />

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082151723.png" alt="image-20220610082151723" style="zoom:67%;" />

环信的ORG_NAME,CLIENT_ID,CLIENT_SECRET这三个字符串就需要复制到服务端所对应的地方。

 

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082203372.png" alt="image-20220610082203372" style="zoom:67%;" />

 

 

在环信注册应用后，每个应用都会有相应的Orgname（企业唯一标识）、Client ID（APP的ID）、Client Secret（APP的Secret）和appname（APP名称）等APP信息，为保证与环信服务端通信的安全性，在服务端向环信服务器发起请求的时候需要在发起网络请求时在HTTP请求中加入Orgname和appname等信息，同样也是为了区分请求的应用。其中，环信的REST接口的访问需要管理员权限才能实现，而管理员权限的实现需要在进行HTTP请求时携带Token来实现，因此在对环信应用进行操作之前需要首先获得Token。在向环信服务器请求Token时有一个重要的数据就是有效时间，有效时间一般是七天，在有效时间内Token是有效的，超出有效时间需要重新申请Token，如果申请Token过度频繁会被环信服务器封号。因此，针对环信的Token和有效时间，APP服务端在数据库中新建Token表，将申请得到的Token和有效时间存储进数据库，在每次访问之前都会验证有效时间，若在有效期内则使用数据库中的Token，否则向环信服务端重新申请Token，APP服务端向环信请求Token的示例如下所示：

```java
curl -X POST -H ‘Content-Type: application/json’ -H ‘Accept:application/json’ -d ‘{

“grant_type”: “clent_credentials”,

“client_id”: “YXA6i-Ak80l4Eei2l11ZjV-EAg”,

“client_secret”: “YXA6VunqiNxoB7IwXHInk1cGiX00Jfc”

}’ ‘http://a1.easemob.com/easemob/easemob-demo/testapp/token’
```

 返回值200表示Token请求成功，可以从返回的请求体中解析出返回的Token和有效时间，返回的数据如下所示:

```java
{

 “access_token”: “YWMte…5kw”,

 “expires_in”: 5184000,

 “application”: “8be02…8402”

}
```

返回值为400则表示请求的client_id或者client_secret错误，环信服务器会返回错误的描述，返回结果如下所示：

```java
{

“erroe_description”: “client_id does not match”,

“error”: “invalid_grant”

}
```

配置完成与环信的通信接口，服务端即可实现与环信服务器之间的通信。在客户端注册账号时，服务端会在环信服务器设立相同的环信账号密码，不同账户之间可以进行通信。

## 6.3 用户交易功能

（参考https://b23.tv/sUNJuP6项目的前端代码)

对于一个网上闲置物品交易软件来说，商品交易是其最基本也是最核心的功能。交易之前，买家可以进入商品详情页面查看商品图片、商品细节、留言评论等信息，可以直接通过商品详情页直接下单，也可以对商品进行留言或者私聊卖家了解商品的更多详细信息。

在交易模块中，具有查看商品详情、联系对方、商品购买、商品出售、确认发货、确认收货等基本功能。前面已经介绍了发布模块、定位模块、商品详情模块和聊天模块，下面介绍在交易功能中很重要的购买，出售，确认收发货的功能。

 

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610080907808.png" alt="image-20220610080907808" style="zoom:67%;" />

​                                                                                                                        图4-22 商品交易流程图

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610080937926.png" alt="image-20220610080937926" style="zoom:67%;" />

​                                                                                                                           图4-22 商品详情图

对于商品详情页面中的多种功能实现，无论是返回、聊天、发送评论还是其他功能，都是通过监听器的功能实现的。在聊天功能外，用户还可以通过商品详情界面用户名右侧的绿色电话按钮向卖家发起通话，对于打电话功能的实现就如下展示。

```java
设置监听变量
private BuydetailActivity.OnClickListener listener;
然后进行初始化监听
listener = new OnClickListener();
iv_buydetail_tel.setOnClickListener(listener);
如古点击打电话的图片，监听器检测到点击事件的发生，代码就会跟证据按键点击的情况执行相应的操作，调用打电话的参数，并且把从接口中拿到的电话号码的返回值，传递给打电话方法中的参数，然后拨打对应号码。
获取电话号码的操作：userCall(uagdata.get("tel").toString());
拨打电话的操作：callIntent.setData(Uri.parse("tel:"+ tel));
```

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081124051.png" alt="image-20220610081124051" style="zoom:67%;" />

​                                                                                                                           图4-26 系统通知

消息页面分为连天消息和系统消息，聊天消息界面主要是和各个用户之间交流，在聊天功能中，引入了环信，客户端集成了环信的SDK用于实现用户的聊天通信，

对系统消息来说，需要采用适配器来为的是listview滚动的时候快速设置值，而不必每次都重新创建很多对象，从而提升性能。当有多条数据的时候，用listview加载每一行数据的时候，会占据大量内存，影响性能，这时候就需要按需填充并重新使用view来减少对象的创建。最快的方式是定义一个ViewHolder，将convetView的tag设置为ViewHolder,不为空时重新使用即可

最快的方式是定义一个ViewHolder，将convetView的tag设置为ViewHolder,不为空时重新使用即可

![image-20220610081155888](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081155888.png)

对于列表类型的数据来说，我们都采用fragment来对数据进行分组的模块化管理，另外Fragment并不能单独使用，他需要嵌套在Activity 中使用，尽管他拥有自己的生命周期，但是还是会受到宿主Activity的生命周期的影响，比如Activity 被destory销毁了，他也会跟着销毁

我们项目中使用到的fragment功能实现：

```Java
Fragment获得Activity中的组件: getActivity().findViewById(R.id.list)；
 Activity获得Fragment中的组件(根据id和tag都可以)：getFragmentManager.findFragmentByid(R.id.fragment1);
```

在整个交易过程中，我们的应用程序成为用户交易的中间人，卖家发货后买家也会收到卖家已发货的系统通知，订单状态变为已发货，等到买家收到货后就可以进行确认收货。买家确认收货后商品状态也由交易中改为已出售，整个交易过程完成。交易完成后，用户可以通过“我的”页面查看自己买到或卖出的商品，也可以查看或删除交易订单。

 

## 6.4 辅助功能模块

（参考https://b23.tv/sUNJuP6项目的前端代码)

本客户端在实现基本的二手交易流程的基础上加入了部分辅助功能，提高用户的使用体验。其中包括商品收藏、浏览附近商品、商品管理等辅助功能，

### 6.4.1 商品收藏

用户在浏览商品时，如果有很多的商品，用户在浏览时总会遇到很多心动的物品，可能一开始还在犹豫要不要买，之后想找又不容易找到，因此应用了面加入了商品收藏的功能。具体的商品收藏功能可以通过商品详情页面商品名右侧的五角星实现，如图4-27所示，

![image-20220610081240073](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610081240073.png)

​                                                                                                                                 图4-27 

用户个人收藏的商品可通过“我的-我的收藏”查看已收藏的商品，并可在本页面对收藏列表中的商品进行取消收藏，也可通过收藏列表进入聊天界面，与卖家取得联系。

​                                                                                                               ![image-20220610082305568](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082305568.png)    

​                                                                                                                        图4-29 我的收藏列表

对于收藏列表这种不光展示数据而且展示图片等多种组建的数据，需要利用到

Adapter(适配器) Adapter是用来帮助填充数据的中间桥梁，可以将各种数据以合适的形式显示到view上,提供 给用户看！

收藏列表采用RecyclerView（循环视图）布局作为商品列表的父布局，并通过相应的Adapter（适配器）显示搜索到的商品信息，将多条商品信息显示到RecyclerView中。在本客户端中，所有图片的加载均采用了Glide图片加载库，如商品图片及用户头像的加载。

### 6.4.2 查看附近商品

  大学师生是拥有闲置物品的主力军，我们为了帮助同学们更方便的以物易物，在应用中添加了查看附近商品的功能。用户在发布物品的时候聚能添加定位，基于百度地图SDK，在用户授予地图权限的基础上客户端可以获取到用户的地理位置，请求数据时会将位置信息上传到服务端，获取到附近的商品，从而拓展了用户发现商品的途径，其界面如图4-30所示。附近的商品的页面布局也是基于fragment实现的。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082244370.png" alt="image-20220610082244370" style="zoom:67%;" />

​                                                                                                                              图4-30 附近商品

我们安卓端中集成了百度地图的SDK，因此发货地点可通过定位实现，也可以点击“发货地”一栏自己选择商品的发货地，引用百度的sdk是一种十分方便的选择。

 

# 七、后端的实现[陈嘉诚、徐晨凯]

## 7.0后端全局（陈嘉诚）

### 7.01实现的基本框架和插件说明

后端的基础框架采用的是**SpringBoot+Mybits**。

SpringBoot框架具有很多优点：

①良好的基因
因为SpringBoot是伴随着Spring 4.0而生的，boot是引导的意思，也就是它的作用其实就是在于帮助开发者快速的搭建Spring框架，因此SpringBoot继承了Spring优秀的基因，在Spring中开发更为方便快捷。
②简化编码
，比如我们要创建一个 web 项目，使用 Spring 的朋友都知道，在使用 Spring 的时候，需要在 pom 文件中添加多个依赖，而 Spring Boot 则会帮助开发着快速启动一个 web 容器，在 Spring Boot 中，我们只需要在 pom 文件中添加如下一个 starter-web 依赖即可。
③简化配置
Spring 虽然使Java EE轻量级框架，但由于其繁琐的配置，一度被人认为是“配置地狱”。各种XML、Annotation配置会让人眼花缭乱，而且配置多的话，如果出错了也很难找出原因。Spring Boot更多的是采用 Java Config 的方式，对 Spring 进行配置。
④简化部署
在使用 Spring 时，项目部署时需要我们在服务器上部署 tomcat，然后把项目打成 war 包扔到 tomcat里，在使用 Spring Boot 后，我们不需要在服务器上去部署 tomcat，因为 Spring Boot 内嵌了 tomcat，我们只需要将项目打成 jar 包，使用 java -jar xxx.jar一键式启动项目。另外，也降低对运行环境的基本要求，环境变量中有JDK即可。

在后端的插件上，我们的后端项目使用了**Lombok**插件。Lombok是一个通过注解以达到减少代码的Java库,如通过注解的方式减少get,set方法,构造方法等。所以后端的entity文件内的参数原型文件看起来都是比较简单的，舍去了繁琐的getter()和setter（）。

另：后端项目使用了**驼峰映射**技术。

### 7.02关于后端文件结构的说明

后端目录结构（IntelliJ IDEA）:

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220607234440397.png" alt="image-20220607234440397" style="zoom:67%;" />

net.Implementist目录：

config文件夹下对应的是后端项目中的MyBatis设置、Swagger设置以及MVC设置

controller下对应的是后端各功能的控制器，entity为实体类，mapper为注解文件，service是服务类，util下是一些额外的功能，包括图片的读取、环信外部服务的连接等，HaowuApplication是基础java文件（在此项目中无用）

resources目录：

mapper文件夹下对应的MyBatis的映射文件，application.yml文件是全局设置文件。

pom.xml是Maven文件的配置文件。



### 7.03关于每一部分功能实现的重复部分

**以下均为例子，不做差异化处理（各功能的实现部分不做重复展示）**

定义参数，返回**JSON**数据（以account为例）：

```java
 User user = new User();
 Message message = new Message();
 JSONObject params = new JSONObject();        //返回JSON数据
```

数据上的对应采用的是**地址映射**（以account为例）：

```java
@RequestMapping(path = "/Account_Servlet", produces = "text/html;charset=utf-8")
```

获取**请求头**（Maven）：

```java
 try { //获得请求头
            String requesttop = request.getParameter("requesttop").trim();
 }
```

功能结束后数据更新(结尾部分)：

```java
ObjectMapper objectMapper = new ObjectMapper();
return objectMapper.writeValueAsString(params);
```



## 7.1订单功能的实现（陈嘉诚）

在该功能的代码中，核心实现了订单发货、订单收获、订单取消三个功能。

### 7.11取消订单实现

1.获取商品状态并修改为在售，获取买家金额并修改金额，获取商品信息（判断商品存在）。

2.同时满足三个逻辑，联系卖家并取消订单，同时修改商品状态（置1）；否则，取消订单失败。

修改用户金额逻辑实现：

```java
double balance = user.getUbalance() + Double.valueOf(request.getParameter("abill").trim());
User target = new User();
target.setUaccount(user.getUaccount()).setUbalance(balance);
```

修改商品状态逻辑（置1）实现：

```java
goodTarget.setGid(Integer.valueOf(request.getParameter("gid").trim())).setGstate(1);
```

联系卖家逻辑实现(if语句内)：

```java
message.setMtitle("【取消订单】");
message.setMcontent("商品【" + request.getParameter("gname").trim() + "】订单已取消，请与对方联系！");
message.setReceiveid(Integer.valueOf(request.getParameter("uid").trim()));
message.setMtime(request.getParameter("time").trim());
message.setMstate(1);
messageService.insertMessage(message);
```

### 7.12订单发货实现

1.获取订单状态并修改状态（置2）。

2.买家获取发货信息；否在，视为商品发货失败。

修改订单逻辑实现（置2）：

```java
account.setAid(Integer.valueOf(request.getParameter("aid").trim())).setAstate(2);
```

获取信息逻辑实现：

```java
message.setMtitle("【发货通知】");
message.setMcontent("您购买的商品【" + request.getParameter("gname").trim() + "】已发货！"); message.setReceiveid(Integer.valueOf(request.getParameter("uid").trim()));
message.setMtime(request.getParameter("time").trim());
message.setMstate(1);
messageService.insertMessage(message);
```

### 7.13订单收货实现

1.获取订单状态并修改（置3），获取卖家金额并修改金额，获取商品信息并修改状态（置3）。

2.同时满足三个逻辑，卖家收到买家收货通知；否则，收货失败。

获取订单逻辑并修改状态（置3）：

```java
account.setAid(Integer.valueOf(request.getParameter("aid").trim())).setAstate(3);
```

获取卖家金额并修改金额：

```java
double getbalance = user.getUbalance() + Double.valueOf(request.getParameter("abill").trim());
User target1 = new User();
target1.setUaccount(user.getUaccount()).setUbalance(getbalance);
```

获取商品信息并修改状态（置3）：

```java
 goodTarget1.setGid(Integer.valueOf(request.getParameter("gid").trim())).setGstate(3);
```

卖家收到通知：

```java
message.setMtitle("【收货通知】");
message.setMcontent("您售出的商品【" + request.getParameter("gname").trim() + "】买家已确认收货！");
message.setReceiveid(Integer.valueOf(request.getParameter("guid").trim()));
message.setMtime(request.getParameter("time").trim());
message.setMstate(1);
messageService.insertMessage(message);
```

## 7.2商品功能的实现（陈嘉诚）

该部分实现的功能主要是商品的命名、提交、类型定义、免费性质等基本逻辑的实现，可以统一理解为各类型的商品上传数据，代码结构比较简单，基本逻辑都是遍历商品查找重复项，若没有重复项，则对应种类的商品在数据中更新该商品。

由于代码结构几乎一致，在这里仅以goodstype(商品类型)为例子进行一定的说明(该段代码为完整的 case:goodstype 的逻辑)：

```java
 case "goodstype":
                    goods = goodsService.queryType(request.getParameter("type").trim(), request.getParameter("state").trim());
                    //获取state参数对应的信息
                    for (Goods good : goods) {//遍历商品
                        uagdata.put("userdata", userService.getById(good.getUid()));//上传数据
                        uagdata.put("goodsdata", good);
                        uaglist.add(uagdata);
                    }
                    params.put("code", "1");//参数标签更新
                    params.put("data", uaglist);
                    System.out.println("商品类型请求成功！");
                    break;
```

## 7.3用户功能的实现（徐晨凯）

### 7.31用户功能分类

user类和person类都属于用户功能，其中，user类实现登录注册功能，person类实现用户信息功能

### 7.32登录功能

实现方法说明(controller):先从数据库中获取已经注册过的账号信息和密码的数据进行匹配在实现登录。

```java
//获取上传的账户密码
String account = request.getParameter("account").trim();
String password = request.getParameter("password").trim();
//验证用户密码
vresult = userService.Loginverify(account,password);
ObjectMapper objectMapper = new ObjectMapper();
return objectMapper.writeValueAsString(vresult);
```

账号验证逻辑（环信）：

```java
User user = queryUserByAccount(account);
if (null == user) {//验证环信账号有没有注册成功
            boolean verifyHx = HXUtil.addUser(account, pwd, nickName);
    if(verifyHx){
                user = new User();
                user.setXX(XX);//XX代表对应的param参数，此处太多不展示
    }
```

密码验证逻辑实现（service）：现将用户的账号密码进行匹配，在根据匹配结果的不同输出不同的结果。

```java
if (null != user && password.equals(user.getPassword())) { 
    //中间的逻辑在下面说明
     }else {//登录失败
            code.put("code", "0");
            System.out.println("登录失败！");
        }//匹配并且判断账号密码是否存在真确
```

逻辑1：登陆成功

```java
 if(user.getState() == 1){
                //将用户的登录状态改为2
                User target = new User();
                target.setUid(user.getUid());
                target.setState(2);
                updateUser(target);
                code.put("code", "1"); 
                data.put(···);//中间为各param对应逻辑匹配此处省略
                System.out.println("登录成功！");
 }//输出成功
```

逻辑2：异地登录

```java
else if(user.getState() == 2){//用户在其他设备已登录
                code.put("code", "2");
                System.out.println("用户在其他设备登录！");
}
```

### 7.32用户注册功能

实现方法说明：按照注册的基本逻辑录入个人信息后数据库更新信息。

录入信息：

```java
String XX = request.getParameter("XX").trim();//XX对应界面提示中需要输入的个人信息（参数）
```

更新信息数据：

```java
JSONObject jsonObject = userService.signupVerify(account, password, nickname, tel, sex);//按照JSON个数将信息写入映射文件中
ObjectMapper objectMapper = new ObjectMapper();
return objectMapper.writeValueAsString(jsonObject);
```

### 7.33密码修改功能实现

方法实现说明：先获取原密码数据，在输入新密码数据覆盖在原来的密码之上后更新数据。

controller实现：

```java
account = request.getParameter("account").trim();//获得原账号密码
password = request.getParameter("pwd").trim();
newpassword = request.getParameter("newpwd").trim();//输入新密码
resultJsonObject = userService.ModifyPwd(account,password,newpassword);//调用service方法处理数据
```

service实现：

```java
User target = new User();
target.setAccount(account).setPassword(newpassword.trim())//设置新密码
boolean modify = refreshUserByAccount(target);
if (modify) {
    vresult.put("code", "1");   //密码修改成功
    data.put("password", newpassword.trim());//更新数据
    vresult.put("data", data);
}
```

### 7.34用户信息功能

方法实现说明：通过“Switch-Case"设置区分不同上传修改功能，从原有的数据中读取数据，不存在则可写入新的数据。

（上传头像，修改昵称，修改地址，修改电话，修改学校）

一般情况的修改数据：

```java
case "changeXX":                       //修改XX功能
                    nickname = request.getParameter("XX").trim();//获取参数
                    user.setXX(XX);
                    result = userService.refreshUserByAccount(user);
                    if (result) {
                        vresult.put("code", "1");   //修改成功
                        data.put("XX", XX);  //数据更新
                        vresult.put("data", data);
                    }
                    break;
```

特殊情况（修改头像）不同处：需要在目录之下新建文件夹用来存放图片

```java
String apppath = request.getRealPath("/")+"appdata";//设置路径
```

```java
String userdata = apppath + "/" + "userdata";
File userfile = new File(userdata);
if(!userfile.exists()){//判断是否存在并新建文件夹
     userfile.mkdir();
}
```

## 7.4公益功能的实现（陈嘉诚）

公益功能中实现了获取我发布公的益功能、获取我参加的公益功能、参加公益、删除公益、获取公益的功能。

### 7.41获取公益功能

该部分设计包括了获取我发布公的益功能、获取我参加的公益功能、获取公益的功能。

因为代码的格式是几乎一样的，所以放在一起进行介绍说明。

基本实现方法：从已有数据中读取订单的相关信息并且匹配与公益相关的信息，遍历其中的公益，再将相关的信息获取更新。

匹配订单信息：

```
 account = userService.queryUserByAccount(request.getParameter("account").trim());
```

遍历公益并且更新：

```java
for (Joincharity joincharity : joincharitys) {//遍历对应数据，此处以参加的公益为例子
                            Charity charity = charityService.getById(joincharity.getCid());
                            caudata.put("charitydata", charity);//更新
                            caudata.put("userdata", userdata);
                            caulist.add(caudata);
                        }
```

### 7.42参加公益功能

逻辑功能实现：定义一个acounnt属于account类并获取其数据，在joincharity中查找是否存早这个account，没有的话就常见一个。之后定义一份charity属于joincharity类并创建，此时该charity获得之前的数据并且在加入的数值上加1，最后更新数据。

定义一个account属于account类：

```java
 User account1 = userService.queryUserByAccount(request.getParameter("account").trim());
```

创建charity并且参加人数加1：

```java
Charity target = new Charity();
target.setCid(charity.getCid());
target.setCjoinnum(charity.getCjoinnum()+1);
```

### 7.43删除公益功能

该功能通过获取charity的ID后获得并修改其的状态（置3）来实现。

获得公益状态并置3：

```java
target.setCid(Integer.valueOf(request.getParameter("cid").trim()));
target.setCstate(3);
```

## 7.5收藏功能的实现（陈嘉诚）

逻辑方法实现：获取账户ID的信息后遍历其收藏夹，如果收藏夹中没有存在需要收藏的商品则录入需要收藏商品的信息到数据，并且更新数据。

遍历方法并录入更新数据：

```java
for (Collect collect : collects) {//遍历收藏
      gacdata.put("collectdata", collect);//上传对应收藏商品的数据
      gacdata.put("goodsdata",goodsService.getById(collect.getGid()));
      gacdata.put("userdata", userService.getById(collect.getGuid()));
      gaclist.add(gacdata);//更新数据
}
```

## 7.6消息功能的实现（陈嘉诚）

此部分功能包括获取消息和修改消息。

### 7.61获取消息

获取消息具体可以分为获取一般的消息和查看未读消息。

获取一般的消息逻辑：获取对应的账号ID查看其消息是否存在再根据具体情况返回对应信息。

```java
if(messagelist.size() > 0){          //查询到有消息返回1
         params.put("code", "1");
         params.put("data", messagelist);
}else if(messagelist.isEmpty()){     //查询到无消息
         params.put("code", "2");
}else {                              //查询出错
         params.put("code", "0");
}
```

查看未读消息的逻辑基本上可以与一般消息看做一类，也是获取对应账户的消息中的对应参数不过换成了unreadlist查看是否为空来返回对应信息。

```java
if(!unreadlist.isEmpty()){//有未读消息
    params.put("code", "1");
}else {//没有未读消息
    params.put("code", "0");
}
```

### 7.62修改消息

方法逻辑说明：通过匹配消息的ID获取消息的状态，更具具体的状态输出对应的反馈结果。

```java
Message target = new Message();
target.setMid(Integer.valueOf(mid));
target.setMstate(Integer.valueOf(state));//设置ID和状态
boolean rs = messageService.refreshMessage(target);
if(rs){//修改成功
      params.put("code", "1");
}else {//修改失败
      params.put("code", "0");
}
```

## 7.7发布功能的实现（陈嘉诚）

发布功能包括商品发布、公益发布、购买发布（申请）三部分。

### 7.71商品发布

商品发布通过用户的账户来发布，在用户的账户ID下发布商品，录入商品的各种信息。由于商品需要配图，所以需要设置路径用来放置图片。

商品发布可以配细分为一般商品发布、一般商品重发布、商品公开发布、商品公开重发布。实际上商品的发布与公开发布只不过是发布的在APP中的位置不太一样，录入数据库后的数据其实在用一张表，慈湖不做细讲。商品的重发布实际上就是对已发布的信息进行数据更新覆盖，没有什么别的操作。

商品发布逻辑实现：
确定存放的地址，建立存放照片的文件夹：判断商品是否为空再建立文件夹。

```java
String goodsdata = apppath + "/" + "goodsdata";
File goodsfile = new File(goodsdata);
if(!goodsfile.exists()){
    goodsfile.mkdir();
}
```

录入商品信息：

```java
user = userService.queryUserByAccount(request.getParameter("uaccount").trim());
goods.setUid(user.getUid());
goods.setXX(request.getParameter("XX").trim());//XX表示对应param标签
```

### 7.72公益发布和购买发布

公益发布和购买发布的实质是和用户发布一样的，只不过是发布的位置不一样，需要记录的信息不一样，本质的代码是一样的。从代码的角度来分析，三种性质的发布只不过是需要发布的类不一样，需要录入的信息不一样，本质都是先创建文件夹mkdir()操作，然后根据各自的情况进行setXXX（）操作并更新即可，所以这里的分析与商品发布一致，故不做重复说明。

## 7.8购买功能的实现（陈嘉诚）

购买功能包括了“我买到的”功能、“我卖出的”功能、删除订单功能。

### 7.81“我买到的”功能

逻辑功能实现：获取用户的订单ID并匹配，查看ID中的信息，遍历其中所有的购买的订单并且获取，有新的订单就录入信息后更新数据。

获取用户订单ID：

```java
User user = userService.queryUserByAccount(request.getParameter("account").trim());
```

匹配订单对应的用户ID：

```java
accoutWrapper.eq(Account::getUid, user.getUid());
```

录入更新订单信息：

```java
 for (Account account : accountList) {//遍历订单
      gaudata.put("accountdata", account);//录入信息
      gaudata.put("goodsdata", goodsService.getById(account.getGid()));
      gaudata.put("userdata", userService.getById(account.getGuid()));
      gaulist.add(gaudata);//更新数据
      }
```

### 7.82“我卖出的”功能

该功能实际上与“我买到的”功能十一样的，只不过是对象ID不一样，换了一个User类对象。在此不做重复说明。

### 7.83删除订单功能

功能实现方法：通过获取订单的ID和状态信息，改变订单的state状态属性，以此达到删除订单的效果。

改变订单属性：

```java
target.setAid(Integer.valueOf(request.getParameter("aid").trim()));
target.setAstate(6);
```

## 7.9评论功能的实现（陈嘉诚）

评论功能主要体现在购买评论（具体商品评论）之下。

评论功能中可以具体分为评论功能、获取评论功能、删除评论功能，附加上浏览人数的改变。

### 7.91评论功能

评论逻辑实现说明：在购买的商品之下进行评论需要是需要在数据中心缓存数据的，所以需要默认录入评论相关的信息。之后，系统会回复消息告知用户评论是否成功，此时购买的商品的之下会展示录入的评论。

录入商品的评论信息：

```java
 Buyconments con = new Buyconments();
con.setXX(request.getParameter("XX"));//XX表示需要录入的param标签
```

评论成功后返回信息：

```java
message.setMtitle("【评论通知】");
message.setMcontent("您的求购商品【" + request.getParameter("bname").trim() + "】有一条新评论！");
message.setReceiveid(Integer.valueOf(request.getParameter("uid").trim()));
message.setMtime(request.getParameter("bcontime").trim());//返回对应信息
message.setMstate(1);
messageService.insertMessage(message);//更新数据
```

### 7.92获取评论功能

逻辑功能实现：获取购买ID匹配数据查看其评论，如果存在评论,则遍历评论并返回所有的评论。

匹配购买ID：

```java
lambdaQueryWrapper.eq(Buyconments::getBid, request.getParameter("bid").trim());
```

### 7.93删除评论功能

逻辑实现方法：通过获取评论的ID并修改评论的状态（置2）来实现。

```java
Buyconments entity = new Buyconments();
entity.setBconid(Integer.valueOf(request.getParameter("bconid").trim()));//获取评论ID
entity.setBconstate(2);//修改状态置2
```

### 7.94修改浏览人数

逻辑实现方法：通过记录浏览过该界面的购买ID，每记录一条ID则浏览人数加1。

```java
Buy target = new Buy();
target.setBid(buy.getBid());
target.setBscannum(buy.getBscannum() + 1);
```



# 八、系统测试（徐晨凯）

## 8.1 单元测试

一共11个测试，为每个service写一个测试，使用junit测试。

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610120730350.png" alt="image-20220610120730350" style="zoom:67%;" />

<img src="file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg" alt="image-20220609003246276" style="zoom:67%;" /

| 测试名字               | 类覆盖率 | 方法覆盖率 | 行覆盖率 |
| ---------------------- | -------- | ---------- | -------- |
| AccountServiceTest     | 100      | 50         | 70       |
| BuyconmentsServiceTest | 100      | 50         | 80       |
| BuyServiceTest         | 100      | 50         | 70       |
| CharityServiceTest     | 100      | 50         | 90       |
| CollectServiceTest     | 100      | 70         | 60       |
| ConmentsServiceTest    | 100      | 70         | 60       |
| GoodsServiceTest       | 100      | 70         | 65       |
| JoincharityServiceTest | 100      | 50         | 90       |
| MessageServiceTest     | 100      | 80         | 80       |
| TokenServiceTest       | 100      | 70         | 60       |
| UserServiceTest        | 100      | 70         | 50       |

## 8.2 集成测试

测试集成到action上检测

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610015425966.png" alt="image-20220610015425966" style="zoom:67%;" />

![image-20220610015442389](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610015442389.png)

## 8.3 测试部署及结果

用github action来部署，新建了一个junit.yml文件

![image-20220610015536876](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610015536876.png)

git action部署文件：如下图是对git action的环境进行部署

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610015627477.png" alt="image-20220610015627477" style="zoom:67%;" />

![image-20220608004116139](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image003.png)

 

 

GitHub Actions 有一些自己的术语：

workflow （工作流程）：持续集成一次运行的过程，就是一个 workflow。
 job （任务）：一个 workflow 由一个或多个 jobs 构成，含义是一次持续集成的运行，可以完成多个任务。
 step（步骤）：每个 job 由多个 step 构成，一步步完成。

action （动作）：每个 step 可以依次执行一个或多个命令（action）。

 

代码的主要流程：

先指定在push或者pull request时触发脚本执行
 拉取ubuntu最新版的镜像
 缓存Maven依赖目录，避免每次都下载全量依赖包，加快执行速度
 安装Java8
 指定pom.xml文件路径我的路径是在后端/HaowuApplicationt/pom.xml，这个很关键，不能写错，随后用Maven编译项目
 然后就是运行Junit单元测试

![image-20220609002819334](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image005.jpg)


# 九、系统部署 [靳洋洋]

部署情况：我们使用Docker进行系统的部署。

Docker版本

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082621564.png" alt="image-20220610082621564" style="zoom:67%;" />

查看所有正在运行的容器信息

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082652325.png" alt="image-20220610082652325" style="zoom:67%;" />

​	查看本地镜像列表

<img src="C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20220610082735211.png" alt="image-20220610082735211" style="zoom:67%;" />



连上mysql，创建数据库haowu，然后把数据库脚本导入进去。

然后clone github的项目，对项目进行打包成jar包。

# 十、功能展示 [陈嘉诚、徐晨凯、靳洋洋]

打开我们的软件就会首先显示我们的应用logo设计页面（图1），然后会自然跳转到登录界面（图3），如果用户是第一次使用的话，可以点击我要注册，然后会跳转到注册页面（图2），填完基础信息，完成注册之后会重新返回到登陆界面（图3），这时候新用户也能进行登录.

 

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)

​          图1 logo设计页面                     图2注册页面                               图3登陆界面

 

登录之后会进到我们应用的主页面（图4），然后用户根据自己的需求做出自己的操作。用户可以在最新发布页（图5）面查看最新发布的商品，在免费送页面（图6）查看免费送的物品、在公益活动页面浏览公益项目（图7）、在我要买页面查看自己发布的求购记录（图8），也能查看求购详情页面（图9）。

 

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image012.jpg)

​          图4应用主页面                          图5最新发布页面                    图6免费物品页面

 

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image014.jpg)   ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image016.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image018.jpg)

​       图7公益活动页面                        图8我想购买页面            图9我想购买详情页面



用户在主页面浏览商品列表（图12）时，可以点击自己感兴趣的商品，产看商品的详细信息（图10），或是其他用户对商品的评价（图11）。

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image020.jpg)   ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image022.jpg)   ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image024.jpg)

图10商品详情页面                             图11商品评论截图                   图12商品列表页面       



为了方便用户挑选自己喜欢的商品，我们还设计了商品分类页面，当用户点击主页面中的更多分类时，会跳转到更详细的商品分类界面（图13）当中，点击热门的手机数码类时，会跳转到手机数码页（图14），显示和手机数码有关的闲置商品。应用还支持搜索功能，比如我想要搜索鼠标，搜索后就会出现和鼠标有关的物品信息（图15），可供用户进行选择。

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image026.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image028.jpg)   ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image030.jpg) 

​         图13商品分类页面                        图14数字数码页面             图15搜索详情页面



应用还有商品发布功能，可以发布自己想要购买的物品、自己想要卖出或者送出的物品，

用户还能够发起公益，让更多志同道合的用户一起无私奉献。

 

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image032.jpg)   ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image034.jpg)   ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image036.jpg)

​                图16发布页面                     图17发布闲置页面            图18发布免费送页面

 

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image038.jpg)   ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image040.jpg)  

​          图19发布求购页面           图20发起公益页面     



用户按照自己的需求发布完各种消息之后，可以点击跳转到个人页面，查看自己发布的各种信息，点击我的发布跳到发布列表详情页面之后，我们还可以对自己发布过的商品进行重新编辑，更改对商品的描述，我发布的求购商品就会和我想要买页面中同步出来，方便查看。

用户还能点击个人页面的我的公益来查看自己参加和发布的公益活动，

 

 

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image042.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image044.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image046.jpg)

​          图21个人中心页面               图22发布列表详情页面               图23编辑商品页面      

 

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image048.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image050.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image052.jpg)

   图24发布求购详情页面             图25个发布公益页面            图26参与公益详情页面

 

 

 

我们还在个人页面集成了很多功能，对于自己买到的商品，可以在个人页面点击我买到的进行查看，我卖出的商品和收藏的商品也能在个人页面访问查看。

 

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image054.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image056.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image058.jpg)

​           图27买到商品页面                图28卖出商品页面                 图29商品收藏页面

  

 

 

 

个人资料也是个人页面比较重要的一块，用来查看和更改用户的个人信息，可以对头像和其他信息进行修改。

 

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image060.jpg)   ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image062.jpg) 

​          图30个人资料页面                 图31更改头像页面     



 

在系统的设置模块可以进行修改密码和退出登录。

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image064.jpg)    ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image066.jpg)  

​       图32商品分类页面                   图33数字数码页面     

 

 

对于消息模块，我们分为了该系统消息和个人消息，当我们发布的物品有人购买的时候，我们可以会受到系统发来的通知，然后在系统消息查看，收到评论的时候，也会通知到系统消息中。对于和其它用户的聊天记录，我们可以在个人页面点击查看。

 

![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image068.jpg)  ![img](file:///C:/Users/86158/AppData/Local/Temp/msohtmlclip1/01/clip_image070.jpg)

​          图15系统消息页面             图15系统消息页面

 



# 十一、清单 [陈嘉诚、徐晨凯、靳洋洋]

这部分列出项目提交的清单，如：

- 前端代码: Haowu
- 后端代码: 后端
- 项目演示视频: videos
- API设计：API
- 数据库设计：Database·
- 每一次PPT汇报和材料：design
- 期末文档PPT：期末汇报

# 十二、总结 [陈嘉诚、徐晨凯、靳洋洋]

## 项目总结

总的来说，感觉实现安卓系统的二手校园平台还是比较困难的。这个项目本身工程量还是很大的，需要考虑的数据间的关系很多，无论是从数据库的创建、API的设计还是后端开发，开发过程中的出现的问题都很多，为此也是花费了不少时间用于查阅资料，调整参数，修改数据、测试。

但是这一种工程量比较大的项目本身而言对我们是一种很好的锻炼自己的代码能力的机会，也很考验组员之间的配合写作。开发的过程是缓慢的，直到项目做完其实还是存在非常多的问题需要去改建。

从现在这个时间回顾项目开始的时候，还是可以发现之前的项目的设计存在很多的问题，这些问题有的到现在也还是没有顺利解决的，项目中也存在一些BUG，有时候后端运行的时候放在外部设备（不是Android虚拟机，这里的外部设备指的是Android实体机）登录系统出现问题的情况（登陆失败，但是放在虚拟机本身暂时没有出现失败的情况），这些问题都需要在后续的不断学习中去发现问题解决问题。

## 项目感受

作为一个团队项目，从这门课程本身的属性而言，是让我们在课程的进度中去体验未来工作中、开发中比较贴近实际的真实开发过程的一种模拟。

从课程开始到现在，我们经历了项目的基础构思、APP的原型设计、项目的系统构架、API设计、数据库开发设计、前端的设计开发、后端的设计开发、web端的设计开发、项目的测试、项目的部署等一些列操做，在最后时期进行项目的更新迭代优化。

可能从课程的角度，我们只不过是按照这些步骤完成了一个大作业，但是从学习的角度，了解的是以后开发一款程序的过程，是对各个流程的熟悉和理解，是对经验的基类，从多方面其接触学习开发的各个技术，是对开发编程能力的提升。

项目本身设计开发得并没有想象中的那么完善，还需要进行进一步的改进，功能层面还需要更贴近实际，还需要不断地发展、进步、优化。

## 进一步规划

虽然整个二手交易系统在现在能够持续稳定的运行，用户可以正常的使用app进行交易，但是相比较于有些已经存在的APP，其中还有许多功能未能实现，比如商品的拍卖功能、商品分享、app的后台管理端等。

商品的拍卖功能可以拓展商品的交易的途径，并且可以使得卖家的商品可以获得更好的价格，因此安卓端中预留了商品拍卖功能。在未来的功能扩展中，希望商品分享功能可以实现将商品分享给自己的微信好友等，让更多的人发现商品，达到“微商”的那一种效果。

app的后台管理也是非常有必要的，我们在这一次的开发中没有去实现。管理员可以通过后台审核用户发布的商品、评论和公益活动等数据，同时管理端也可以向客户端推送消息、广告等，能够更加完善整个二手交易平台的功能。

团队协作方面也出现过冲突的问题。

综上所述，项目还是存在很多地不足。虽然课程开发上算是告一段落，但是学习是不可以停止的。项目不具备、不完善的功能还需要扩展实施，不懂的技术还需要去了解、去学习，为解决的BUG还需要去深究、去探讨。

希望在以后的开发中能够使用更多的新技术、新方法，提升团队协作的能力，提高自身的水平，在以后做出更好的项目。

### 

# 十二、参考文献 [陈嘉诚、徐晨凯、靳洋洋]

系统所参考的文献或者代码，比如：

- [Spring Boot](https://spring.io/projects/spring-boot)
- [MyBatis中文网](https://mybatis.net.cn/)
- [Project Lombok](https://projectlombok.org/)
- [MySQL](https://www.mysql.com/)
- [Navicat | 支持 MySQL、MariaDB、MongoDB、SQL Server、SQLite、Oracle 和 PostgreSQL 的数据库管理](https://www.navicat.com.cn/)
- [Apifox - API 文档、调试、Mock、测试一体化协作平台 - 接口文档工具，接口自动化测试工具，接口Mock工具，API文档工具，API Mock工具，API自动化测试工具](https://www.apifox.cn/?utm_source=baidu_sem2)
- [jUnit 教程_w3cschool](https://www.w3cschool.cn/junit/)
- https://www.bilibili.com/video/BV127411W7Yk?p=1&share_medium=iphone&share_plat=ios&share_source=WEIXIN&share_tag=s_i&timestamp=1654748559&unique_k=hIynVRk
- https://blog.csdn.net/qq_39310063/article/details/121984004
- https://juejin.cn/post/6844904142620622862

